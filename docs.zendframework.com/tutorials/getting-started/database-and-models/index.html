<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <link rel="shortcut icon" href="../../img/favicon.ico">

    <title>Database and Models - tutorials</title>

    <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/2.018/css/hack.min.css">
    <link href="//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Libre+Baskerville:400,400italic,700&subset=latin,latin-ext" rel="stylesheet" type="text/css">
    <link href="../../css/base.css" rel="stylesheet">
    <link href="../../css/zf-web.css" rel="stylesheet">
    <link href="../../css/zf.css" rel="stylesheet">
    <link href="../../css/prism-zf.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <span class="navbar-brand">
              <a class="logo-link" href="http://framework.zend.com" data-toggle="tooltip" data-placement="bottom" title="Zend Framework"><img src="../../img/zf-logo-mark.svg" height="28" alt="Zend Framework" /></a>
              <a href="../..">tutorials</a>
            </span>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">MVC Tutorials <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Getting Started with Zend Framework</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../overview/">Overview</a>
</li>

        
            
<li >
    <a href="../skeleton-application/">The Skeleton Application</a>
</li>

        
            
<li >
    <a href="../modules/">Modules</a>
</li>

        
            
<li >
    <a href="../routing-and-controllers/">Routing and Controllers</a>
</li>

        
            
<li class="active">
    <a href="./">Database and Models</a>
</li>

        
            
<li >
    <a href="../forms-and-actions/">Forms and Actions</a>
</li>

        
            
<li >
    <a href="../conclusion/">Conclusion</a>
</li>

        
    </ul>
  </li>

                        
                            
<li >
    <a href="../../unit-testing/">Unit Testing A zend-mvc Application</a>
</li>

                        
                            
<li >
    <a href="../../navigation/">Adding zend-navigation to the Album Module</a>
</li>

                        
                            
<li >
    <a href="../../pagination/">Adding zend-paginator to the Album Module</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">In-Depth Tutorial</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../in-depth-guide/first-module/">Introducing the Blog Module</a>
</li>

        
            
<li >
    <a href="../../in-depth-guide/models-and-servicemanager/">Models and the ServiceManager</a>
</li>

        
            
<li >
    <a href="../../in-depth-guide/preparing-databases/">Preparing for Different Databases</a>
</li>

        
            
<li >
    <a href="../../in-depth-guide/zend-db-sql-zend-hydrator/">SQL Abstraction and Object Hydration</a>
</li>

        
            
<li >
    <a href="../../in-depth-guide/understanding-routing/">Understanding the Router</a>
</li>

        
            
<li >
    <a href="../../in-depth-guide/zend-form-zend-form-fieldset/">Making Use of Forms and Fieldsets</a>
</li>

        
            
<li >
    <a href="../../in-depth-guide/data-binding/">Editing and Deleting Data</a>
</li>

        
            
<li >
    <a href="../../in-depth-guide/review/">Reviewing the Blog Module</a>
</li>

        
    </ul>
  </li>

                        
                            
<li >
    <a href="../../advanced-config/">Advanced Configuration</a>
</li>

                        
                            
<li >
    <a href="../../i18n/">Internationalization</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Component Tutorials <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../db-adapter/">Setting Up A Database Adapter</a>
</li>

                        
                            
<li >
    <a href="../../event-manager/">Using the EventManager</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Migration <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">To Version 3</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../migration/to-v3/overview/">Overview</a>
</li>

        
            
<li >
    <a href="../../migration/to-v3/components/">Components</a>
</li>

        
            
<li >
    <a href="../../migration/to-v3/application/">Applications</a>
</li>

        
    </ul>
  </li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" class="component-toggle" data-toggle="tooltip" data-placement="bottom" title="Show component list">
                        <i class="fa fa-book"></i> Components
                    </a>
                </li>

                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li>
                        <a href="https://github.com/zendframework/tutorials">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

    <!-- content:begin -->
    <div id="page-top" class="container docs">
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#database-and-models">Database and models</a></li>
        
            <li><a href="#the-database">The database</a></li>
        
            <li><a href="#the-model-files">The model files</a></li>
        
            <li><a href="#using-servicemanager-to-configure-the-table-gateway-and-inject-into-the-albumtable">Using ServiceManager to configure the table gateway and inject into the AlbumTable</a></li>
        
            <li><a href="#back-to-the-controller">Back to the controller</a></li>
        
            <li><a href="#listing-albums">Listing albums</a></li>
        
    
    </ul>

    
    <ul class="pager hidden-print">
      <li class="previous">
        <a rel="prev" href="../routing-and-controllers/"><i class="fa fa-arrow-left"></i> Previous</a>
      </li>
      <li class="next">
        <a rel="next" href="../forms-and-actions/">Next <i class="fa fa-arrow-right"></i></a>
      </li>
    </ul>
    
</div></div>
        <div class="col-md-9" role="main">

<ol class="breadcrumb" role="navigation" aria-label="breadcrumbs navigation">
  <li><a href="../..">tutorials</a> &raquo;</li>
  
    
      
        <li>MVC Tutorials &raquo;</li>
      
    
      
        <li>Getting Started with Zend Framework &raquo;</li>
      
    
  
  <li class="active">Database and Models</li>
</ol>

<h1 id="database-and-models">Database and models</h1>
<h2 id="the-database">The database</h2>
<p>Now that we have the <code>Album</code> module set up with controller action methods and
view scripts, it is time to look at the model section of our application.
Remember that the model is the part that deals with the application's core
purpose (the so-called “business rules”) and, in our case, deals with the
database. We will make use of zend-db's <code>Zend\Db\TableGateway\TableGateway</code> to
find, insert, update, and delete rows from a database table.</p>
<p>We are going to use Sqlite, via PHP's PDO driver. Create a text file
<code>data/schema.sql</code> with the following contents:</p>
<pre class="codehilite"><code class="language-sql linenums">CREATE TABLE album (id INTEGER PRIMARY KEY AUTOINCREMENT, artist varchar(100) NOT NULL, title varchar(100) NOT NULL);
INSERT INTO album (artist, title) VALUES ('The Military Wives', 'In My Dreams');
INSERT INTO album (artist, title) VALUES ('Adele', '21');
INSERT INTO album (artist, title) VALUES ('Bruce Springsteen', 'Wrecking Ball (Deluxe)');
INSERT INTO album (artist, title) VALUES ('Lana Del Rey', 'Born To Die');
INSERT INTO album (artist, title) VALUES ('Gotye', 'Making Mirrors');</code></pre>

<p>(The test data chosen happens to be the Bestsellers on Amazon UK at the time of writing!)</p>
<p>Now create the database using the following:</p>
<pre class="codehilite"><code class="language-bash linenums">$ sqlite data/zftutorial.db &lt; data/schema.sql</code></pre>

<p>Some systems, including Ubuntu, use the command <code>sqlite3</code>; check to see which
one to use on your system.</p>
<blockquote>
<h3 id="using-php-to-create-the-database">Using PHP to create the database</h3>
<p>If you do not have Sqlite installed on your system, you can use PHP to load
the database using the same SQL schema file created earlier. Create the file
<code>data/load_db.php</code> with the following contents:</p>
<pre class="codehilite"><code class="language-php linenums">&lt;?php
$db = new PDO('sqlite:' . realpath(__DIR__) . '/zftutorial.db');
$fh = fopen(__DIR__ . '/schema.sql', 'r');
while ($line = fread($fh, 4096)) {
    $db-&gt;exec($line);
}
fclose($fh);</code></pre>

<p>Once created, execute it:</p>
<pre class="codehilite"><code class="language-bash linenums">$ php data/load_db.php</code></pre>

</blockquote>
<p>We now have some data in a database and can write a very simple model for it.</p>
<h2 id="the-model-files">The model files</h2>
<p>Zend Framework does not provide a zend-model component because the model is your
business logic, and it's up to you to decide how you want it to work. There are
many components that you can use for this depending on your needs. One approach
is to have model classes represent each entity in your application and then use
mapper objects that load and save entities to the database. Another is to use an
Object-Relational Mapping (ORM) technology, such as Doctrine or Propel.</p>
<p>For this tutorial, we are going to create a model by creating an <code>AlbumTable</code>
class that consumes a <code>Zend\Db\TableGateway\TableGateway</code>, and in which each
album will be represented as an <code>Album</code> object (known as an <em>entity</em>). This is
an implementation of the <a href="http://martinfowler.com/eaaCatalog/tableDataGateway.html">Table Data Gateway</a>
design pattern to allow for interfacing with data in a database table. Be aware,
though, that the Table Data Gateway pattern can become limiting in larger
systems. There is also a temptation to put database access code into controller
action methods as these are exposed by <code>Zend\Db\TableGateway\AbstractTableGateway</code>.
<em>Don't do this</em>!</p>
<p>Let's start by creating a file called <code>Album.php</code> under
<code>module/Album/src/Model</code>:</p>
<pre class="codehilite"><code class="language-php linenums">namespace Album\Model;

class Album
{
    public $id;
    public $artist;
    public $title;

    public function exchangeArray(array $data)
    {
        $this-&gt;id     = !empty($data['id']) ? $data['id'] : null;
        $this-&gt;artist = !empty($data['artist']) ? $data['artist'] : null;
        $this-&gt;title  = !empty($data['title']) ? $data['title'] : null;
    }
}</code></pre>

<p>Our <code>Album</code> entity object is a PHP class. In order to work with zend-db's
<code>TableGateway</code> class, we need to implement the <code>exchangeArray()</code> method; this
method copies the data from the provided array to our entity's properties. We
will add an input filter later to ensure the values injected are valid.</p>
<p>Next, we create our <code>AlbumTable.php</code> file in <code>module/Album/src/Model</code> directory like this:</p>
<pre class="codehilite"><code class="language-php linenums">namespace Album\Model;

use RuntimeException;
use Zend\Db\TableGateway\TableGatewayInterface;

class AlbumTable
{
    private $tableGateway;

    public function __construct(TableGatewayInterface $tableGateway)
    {
        $this-&gt;tableGateway = $tableGateway;
    }

    public function fetchAll()
    {
        return $this-&gt;tableGateway-&gt;select();
    }

    public function getAlbum($id)
    {
        $id = (int) $id;
        $rowset = $this-&gt;tableGateway-&gt;select(['id' =&gt; $id]);
        $row = $rowset-&gt;current();
        if (! $row) {
            throw new RuntimeException(sprintf(
                'Could not find row with identifier %d',
                $id
            ));
        }

        return $row;
    }

    public function saveAlbum(Album $album)
    {
        $data = [
            'artist' =&gt; $album-&gt;artist,
            'title'  =&gt; $album-&gt;title,
        ];

        $id = (int) $album-&gt;id;

        if ($id === 0) {
            $this-&gt;tableGateway-&gt;insert($data);
            return;
        }

        if (! $this-&gt;getAlbum($id)) {
            throw new RuntimeException(sprintf(
                'Cannot update album with identifier %d; does not exist',
                $id
            ));
        }

        $this-&gt;tableGateway-&gt;update($data, ['id' =&gt; $id]);
    }

    public function deleteAlbum($id)
    {
        $this-&gt;tableGateway-&gt;delete(['id' =&gt; (int) $id]);
    }
}
</code></pre>

<p>There's a lot going on here. Firstly, we set the protected property
<code>$tableGateway</code> to the <code>TableGateway</code> instance passed in the constructor,
hinting against the <code>TableGatewayInterface</code> (which allows us to provide
alternate implementations easily, including mock instances during testing). We
will use this to perform operations on the database table for our albums.</p>
<p>We then create some helper methods that our application will use to interface
with the table gateway. <code>fetchAll()</code> retrieves all albums rows from the database
as a <code>ResultSet</code>, <code>getAlbum()</code> retrieves a single row as an <code>Album</code> object,
<code>saveAlbum()</code> either creates a new row in the database or updates a row that
already exists, and <code>deleteAlbum()</code> removes the row completely. The code for each
of these methods is, hopefully, self-explanatory.</p>
<h2 id="using-servicemanager-to-configure-the-table-gateway-and-inject-into-the-albumtable">Using ServiceManager to configure the table gateway and inject into the AlbumTable</h2>
<p>In order to always use the same instance of our <code>AlbumTable</code>, we will use the
<code>ServiceManager</code> to define how to create one. This is most easily done in the
<code>Module</code> class where we create a method called <code>getServiceConfig()</code> which is
automatically called by the <code>ModuleManager</code> and applied to the <code>ServiceManager</code>.
We'll then be able to retrieve when we need it.</p>
<p>To configure the <code>ServiceManager</code>, we can either supply the name of the class to
be instantiated or a factory (closure, callback, or class name of a factory
class) that instantiates the object when the <code>ServiceManager</code> needs it. We start
by implementing <code>getServiceConfig()</code> to provide a factory that creates an
<code>AlbumTable</code>. Add this method to the bottom of the <code>module/Album/src/Module.php</code>
file:</p>
<pre class="codehilite"><code class="language-php linenums">namespace Album;

// Add these import statements:
use Zend\Db\Adapter\AdapterInterface;
use Zend\Db\ResultSet\ResultSet;
use Zend\Db\TableGateway\TableGateway;
use Zend\ModuleManager\Feature\ConfigProviderInterface;

class Module implements ConfigProviderInterface
{
    // getConfig() method is here

    // Add this method:
    public function getServiceConfig()
    {
        return [
            'factories' =&gt; [
                Model\AlbumTable::class =&gt; function($container) {
                    $tableGateway = $container-&gt;get(Model\AlbumTableGateway::class);
                    return new Model\AlbumTable($tableGateway);
                },
                Model\AlbumTableGateway::class =&gt; function ($container) {
                    $dbAdapter = $container-&gt;get(AdapterInterface::class);
                    $resultSetPrototype = new ResultSet();
                    $resultSetPrototype-&gt;setArrayObjectPrototype(new Model\Album());
                    return new TableGateway('album', $dbAdapter, null, $resultSetPrototype);
                },
            ],
        ];
    }
}</code></pre>

<p>This method returns an array of <code>factories</code> that are all merged together by the
<code>ModuleManager</code> before passing them to the <code>ServiceManager</code>. The factory for
<code>Album\Model\AlbumTable</code> uses the <code>ServiceManager</code> to create an
<code>Album\Model\AlbumTableGateway</code> service representing a <code>TableGateway</code> to pass to
its constructor. We also tell the <code>ServiceManager</code> that the <code>AlbumTableGateway</code>
service is created by fetching a <code>Zend\Db\Adapter\AdapterInterface</code>
implementation (also from the <code>ServiceManager</code>) and using it to create a
<code>TableGateway</code> object. The <code>TableGateway</code> is told to use an <code>Album</code> object
whenever it creates a new result row. The <code>TableGateway</code> classes use the
prototype pattern for creation of result sets and entities. This means that
instead of instantiating when required, the system clones a previously
instantiated object. See
<a href="http://ralphschindler.com/2012/03/09/php-constructor-best-practices-and-the-prototype-pattern">PHP Constructor Best Practices and the Prototype Pattern</a>
for more details.</p>
<blockquote>
<h3 id="factories">Factories</h3>
<p>The above demonstrates building factories as closures within your module
class. Another option is to build the factory as a <em>class</em>, and then map the
class in your module configuration. This approach has a number of benefits:</p>
<ul>
<li>The code is not parsed or executed unless the factory is invoked.</li>
<li>You can easily unit test the factory to ensure it does what it should.</li>
<li>You can extend the factory if desired.</li>
<li>You can re-use the factory across multiple instances that have related
  construction.</li>
</ul>
<p>Creating factories is covered in the <a href="https://zendframework.github.io/zend-servicemanager/configuring-the-service-manager/#factories">zend-servicemanager documentation</a>.</p>
</blockquote>
<p>The <code>Zend\Db\Adapter\AdapterInterface</code> service is registered by the zend-db
component.  You may have noticed earlier that <code>config/modules.config.php</code>
contains the following entries:</p>
<pre class="codehilite"><code class="language-php linenums">return [
    'Zend\Form',
    'Zend\Db',
    'Zend\Router',
    'Zend\Validator',
    /* ... */
],</code></pre>

<p>All Zend Framework components that provide zend-servicemanager configuration are
also exposed as modules themselves; the prompts as to where to register the
components during our initial installation occurred to ensure that the above
entries are created for you.</p>
<p>The end result is that we can already rely on having a factory for the
<code>Zend\Db\Adapter\AdapterInterface</code> service; now we need to provide configuration
so it can create an adapter for us.</p>
<p>Zend Framework's <code>ModuleManager</code> merges all the configuration from each module's
<code>module.config.php</code> file, and then merges in the files in <code>config/autoload/</code>
(first <code>*.global.php</code> files, and then <code>*.local.php</code> files). We'll add our
database configuration information to <code>global.php</code>, which you should commit to
your version control system. You can use <code>local.php</code> (outside of the VCS) to
store the credentials for your database if you want to. Modify
<code>config/autoload/global.php</code> (in the project root, not inside the <code>Album</code>
module) with following code:</p>
<pre class="codehilite"><code class="language-php linenums">return [
    'db' =&gt; [
        'driver' =&gt; 'Pdo',
        'dsn'    =&gt; sprintf('sqlite:%s/data/zftutorial.db', realpath(getcwd())),
    ],
];</code></pre>

<p>If you were configuring a database that required credentials, you would put the
general configuration in your <code>config/autoload/global.php</code>, and then the
configuration for the current environment, including the DSN and credentials, in
the <code>config/autoload/local.php</code> file. These get merged when the application
runs, ensuring you have a full definition, but allows you to keep files with
credentials outside of version control.</p>
<h2 id="back-to-the-controller">Back to the controller</h2>
<p>Now that we have a model, we need to inject it into our controller so we can use
it.</p>
<p>Firstly, we'll add a constructor to our controller. Open the file
<code>module/Album/src/Controller/AlbumController.php</code> and add the following property
and constructor:</p>
<pre class="codehilite"><code class="language-php linenums">namespace Album\Controller;

// Add the following import:
use Album\Model\AlbumTable;
use Zend\Mvc\Controller\AbstractActionController;
use Zend\View\Model\ViewModel;

class AlbumController extends AbstractActionController
{
    // Add this property:
    private $table;

    // Add this constructor:
    public function __construct(AlbumTable $table)
    {
        $this-&gt;table = $table;
    }

    /* ... */
}</code></pre>

<p>Our controller now depends on <code>AlbumTable</code>, so we will need to create a factory
for the controller.  Similar to how we created factories for the model, we'll
create it in our <code>Module</code> class, only this time, under a new method,
<code>Album\Module::getControllerConfig()</code>:</p>
<pre class="codehilite"><code class="language-php linenums">namespace Album;

use Zend\Db\Adapter\Adapter;
use Zend\Db\ResultSet\ResultSet;
use Zend\Db\TableGateway\TableGateway;
use Zend\ModuleManager\Feature\ConfigProviderInterface;

class Module implements ConfigProviderInterface
{
    // getConfig() and getServiceConfig methods are here

    // Add this method:
    public function getControllerConfig()
    {
        return [
            'factories' =&gt; [
                Controller\AlbumController::class =&gt; function($container) {
                    return new Controller\AlbumController(
                        $container-&gt;get(Model\AlbumTable::class)
                    );
                },
            ],
        ];
    }
}</code></pre>

<p>Because we're now defining our own factory, we can modify our
<code>module.config.php</code> to remove the definition. Open
<code>module/Album/config/module.config.php</code> and remove the following lines:</p>
<pre class="codehilite"><code class="language-php linenums">&lt;?php
namespace Album;

// Remove this:
use Zend\ServiceManager\Factory\InvokableFactory;

return [
    // And remove the entire &quot;controllers&quot; section here:
    'controllers' =&gt; [
        'factories' =&gt; [
            Controller\AlbumController::class =&gt; InvokableFactory::class,
        ],
    ],

    /* ... */
];</code></pre>

<p>We can now access the property <code>$table</code> from within our controller whenever we
need to interact with our model.</p>
<h2 id="listing-albums">Listing albums</h2>
<p>In order to list the albums, we need to retrieve them from the model and pass
them to the view. To do this, we fill in <code>indexAction()</code> within
<code>AlbumController</code>. Update the <code>AlbumController::indexAction()</code> as follows:</p>
<pre class="codehilite"><code class="language-php linenums">// module/Album/src/Controller/AlbumController.php:
// ...
    public function indexAction()
    {
        return new ViewModel([
            'albums' =&gt; $this-&gt;table-&gt;fetchAll(),
        ]);
    }
// ...</code></pre>

<p>With Zend Framework, in order to set variables in the view, we return a
<code>ViewModel</code> instance where the first parameter of the constructor is an array
containing data we wish to represent. These are then automatically passed to the
view script. The <code>ViewModel</code> object also allows us to change the view script
that is used, but the default is to use <code>{module name}/{controller name}/{action
name}</code>. We can now fill in the <code>index.phtml</code> view script:</p>
<pre class="codehilite"><code class="language-php linenums">&lt;?php
// module/Album/view/album/album/index.phtml:

$title = 'My albums';
$this-&gt;headTitle($title);
?&gt;
&lt;h1&gt;&lt;?= $this-&gt;escapeHtml($title) ?&gt;&lt;/h1&gt;
&lt;p&gt;
    &lt;a href=&quot;&lt;?= $this-&gt;url('album', ['action' =&gt; 'add']) ?&gt;&quot;&gt;Add new album&lt;/a&gt;
&lt;/p&gt;

&lt;table class=&quot;table&quot;&gt;
&lt;tr&gt;
    &lt;th&gt;Title&lt;/th&gt;
    &lt;th&gt;Artist&lt;/th&gt;
    &lt;th&gt;&amp;nbsp;&lt;/th&gt;
&lt;/tr&gt;
&lt;?php foreach ($albums as $album) : ?&gt;
    &lt;tr&gt;
        &lt;td&gt;&lt;?= $this-&gt;escapeHtml($album-&gt;title) ?&gt;&lt;/td&gt;
        &lt;td&gt;&lt;?= $this-&gt;escapeHtml($album-&gt;artist) ?&gt;&lt;/td&gt;
        &lt;td&gt;
            &lt;a href=&quot;&lt;?= $this-&gt;url('album', ['action' =&gt; 'edit', 'id' =&gt; $album-&gt;id]) ?&gt;&quot;&gt;Edit&lt;/a&gt;
            &lt;a href=&quot;&lt;?= $this-&gt;url('album', ['action' =&gt; 'delete', 'id' =&gt; $album-&gt;id]) ?&gt;&quot;&gt;Delete&lt;/a&gt;
        &lt;/td&gt;
    &lt;/tr&gt;
&lt;?php endforeach; ?&gt;
&lt;/table&gt;</code></pre>

<p>The first thing we do is to set the title for the page (used in the layout) and
also set the title for the <code>&lt;head&gt;</code> section using the <code>headTitle()</code> view helper
which will display in the browser's title bar. We then create a link to add a
new album.</p>
<p>The <code>url()</code> view helper is provided by zend-mvc and zend-view, and is used to create
the links we need. The first parameter to <code>url()</code> is the route name we wish to
use for construction of the URL, and the second parameter is an array of
variables to substitute into route placeholders. In this case we use our <code>album</code>
route which is set up to accept two placeholder variables: <code>action</code> and <code>id</code>.</p>
<p>We iterate over the <code>$albums</code> that we assigned from the controller action.
zend-view automatically ensures that these variables are extracted into the
scope of the view script; you may also access them using <code>$this-&gt;{variable
name}</code> in order to differentiate between variables provided to the view script
and those created inside it.</p>
<p>We then create a table to display each album's title and artist, and provide
links to allow for editing and deleting the record. A standard <code>foreach:</code> loop
is used to iterate over the list of albums, and we use the alternate form using
a colon and <code>endforeach;</code> as it is easier to scan than to try and match up
braces. Again, the <code>url()</code> view helper is used to create the edit and delete
links.</p>
<blockquote>
<h3 id="escaping">Escaping</h3>
<p>We always use the <code>escapeHtml()</code> view helper to help protect ourselves from
<a href="http://en.wikipedia.org/wiki/Cross-site_scripting">Cross Site Scripting (XSS) vulnerabilities</a>.</p>
</blockquote>
<p>If you open <code>http://localhost:8080/album</code> (or <code>http://zf-tutorial.localhost/album</code> 
if you are using self-hosted Apache) you should see this:</p>
<p><img alt="Initial album listing" src="../../images/user-guide.database-and-models.album-list.png" class="img-responsive"/></p>

<hr />


<nav>
  <ul class="pager hidden-print">
    <li class="previous">
      <a rel="prev" href="../routing-and-controllers/"><i class="fa fa-arrow-left"></i> Previous</a>
    </li>
    <li class="next">
      <a rel="next" href="../forms-and-actions/">Next <i class="fa fa-arrow-right"></i></a>
    </li>
  </ul>
</nav>
</div>
        
    </div>
    <!-- content:end -->

    <div id="footerwrap">
    <div class="container">
        <div class="row site-map">
            <div class="col-lg-3">
              <p>
                <strong>Zend Framework</strong><br />
                <a href="http://framework.zend.com/">framework.zend.com</a><br />
                <a href="https://docs.zendframework.com">docs.zendframework.com</a><br />
                <a href="https://packages.zendframework.com">packages.zendframework.com</a><br />
                <a href="https://apigility.org">apigility.org</a><br />
              </p>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12 centered">
                <a class="back-to-top" href="#page-top"><i class="fa fa-chevron-circle-up fa-4" aria-hidden="true"></i></a>
            </div>
        </div>

        <div class="spacing"></div>

        <div class="row">
            <div class="col-lg-8">
                <h4>Copyright</h4>
                <div class="hline-w"></div>

                <p>&copy; 2006-2016 by <a href="http://www.zend.com">Zend</a>, a <a href="http://www.roguewave.com/">Rogue Wave Company</a>.</p>
            </div>

            <div class="col-lg-4">
                <h4>Contacts</h4>
                <div class="hline-w"></div>
                <p>
                    <a href="irc://irc.freenode.net/zftalk" class="btn-social btn-outline" alt="IRC" title="IRC"><i class="fa fa-comment"></i></a>
                    <a href="https://github.com/zendframework" class="btn-social btn-outline" alt="Github" title="Github"><i class="fa fa-github"></i></a>
                    <a href="https://twitter.com/zfdevteam" class="btn-social btn-outline" alt="Twitter" title="Twitter"><i class="fa fa-twitter"></i></a>
                </p>
            </div>
        </div>
    </div>
</div>


    <script src="../../js/jquery-1.10.2.min.js"></script>
    <script src="../../js/bootstrap-3.0.3.min.js"></script>
    <script src="../../js/prism-zf.js"></script>

    <script>var base_url = '../..';</script>
    <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
    <script src="../../js/base.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    <div class="zf-components">
  <div class="zf-components-grid">
    <div class="zf-logo">
      <a href="http://framework.zend.com" data-toggle="tooltip" data-placement="bottom" title="Go to the ZF homepage"><img src="../../img/zf-logo-mark.svg" alt="Zend Framework" width="250" /></a>
    </div>

    <div class="component-list"></div>

    <p class="zf-components-rollup"><a href="#">Hide list</a></p>
  </div>
</div>

    <script>
  // Prepare the component list dropdown for display
  $(function () {
    var components = $(".zf-components"),
        componentList = components.find(".component-list"),
        sidebar = $(".bs-sidebar.affix"),
        sidebarInitialPos = sidebar.css("position"),
        hidden,
        componentToggle = $(".component-toggle"),
        navbar = $(".navbar-fixed-top"),
        rollUpLink = $(".zf-components-rollup a");

    // Initial setup on document load
    components.insertBefore(navbar);
    $(".zf-logo a").tooltip();
    componentToggle.tooltip();
    rollUpLink.attr({ href: "#", alt: "Hide component list" });

    // Cast initial sidebar position value
    if (undefined === sidebarInitialPos) {
      sidebarInitialPos = "fixed";
    }

    // Setup onclick events to toggle list
    componentToggle.click(toggleComponentList);
    rollUpLink.click(toggleComponentList);

    // Toggle the component list display
    function toggleComponentList(event) {
      event.preventDefault();

      if (hidden === undefined) {
        // Not loaded yet; load and display.
        loadComponentList();
        return;
      }

      if (hidden) {
        // Hidden; display.
        showComponentList();
        return;
      }

      // Currently visible; hide
      hideComponentList();
    }

    // Show the component list
    function showComponentList() {
      navbar.css({position: "relative"});
      sidebar.css({position: "relative"});
      components
        .css({"margin-top": "-" + components.outerHeight() + "px"})
        .show()
        .animate({"margin-top": 0}, {
          complete: function () {
            componentToggle
              .data("placement", "top")
              .attr("data-original-title", "Hide component list");
            hidden = false;
          },
          queue: false
        });
    }

    // Hide the component list
    function hideComponentList() {
      components.animate({"margin-top": "-" + components.outerHeight() + "px"}, {
        complete: function () {
          navbar.css({position: "fixed"});
          sidebar.css({position: sidebarInitialPos});
          componentToggle
            .data("placement", "bottom")
            .attr("data-original-title", "Show component list");
          components.hide();
          hidden = true;
        },
        queue: false
      });
      sidebar.animate({ top: sidebarInitialTop + "px" }, { queue: false});
    }

    // Inject a component into the componet list DOM.
    function injectComponent(index, component) {
      componentList.append('<div class="component"><h4><a href="' + component.url + '">' + component.name + '</a></h4><p>' + component.description + '</p></div>');
    }

    // Parse the component list, build the DOM, and display it.
    function parseComponentList(components) {
      $.each(components, injectComponent);
      showComponentList();
    }

    // Fetch the component list and display it.
    function loadComponentList () {
      $.ajax({
        url: "//docs.zendframework.com/zf-mkdoc-theme/scripts/zf-component-list.json",
        dataType: "text json",
        success: parseComponentList,
        error: function (e) {
          console.log("Error occurred with XHR call", e);
        }
      });
    }
  });
</script>
    </body>

</html>
