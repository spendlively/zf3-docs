<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <link rel="shortcut icon" href="../img/favicon.ico">

    <title>Advanced Configuration - tutorials</title>

    <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/2.018/css/hack.min.css">
    <link href="//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Libre+Baskerville:400,400italic,700&subset=latin,latin-ext" rel="stylesheet" type="text/css">
    <link href="../css/base.css" rel="stylesheet">
    <link href="../css/zf-web.css" rel="stylesheet">
    <link href="../css/zf.css" rel="stylesheet">
    <link href="../css/prism-zf.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <span class="navbar-brand">
              <a class="logo-link" href="http://framework.zend.com" data-toggle="tooltip" data-placement="bottom" title="Zend Framework"><img src="../img/zf-logo-mark.svg" height="28" alt="Zend Framework" /></a>
              <a href="..">tutorials</a>
            </span>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">MVC Tutorials <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Getting Started with Zend Framework</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../getting-started/overview/">Overview</a>
</li>

        
            
<li >
    <a href="../getting-started/skeleton-application/">The Skeleton Application</a>
</li>

        
            
<li >
    <a href="../getting-started/modules/">Modules</a>
</li>

        
            
<li >
    <a href="../getting-started/routing-and-controllers/">Routing and Controllers</a>
</li>

        
            
<li >
    <a href="../getting-started/database-and-models/">Database and Models</a>
</li>

        
            
<li >
    <a href="../getting-started/forms-and-actions/">Forms and Actions</a>
</li>

        
            
<li >
    <a href="../getting-started/conclusion/">Conclusion</a>
</li>

        
    </ul>
  </li>

                        
                            
<li >
    <a href="../unit-testing/">Unit Testing A zend-mvc Application</a>
</li>

                        
                            
<li >
    <a href="../navigation/">Adding zend-navigation to the Album Module</a>
</li>

                        
                            
<li >
    <a href="../pagination/">Adding zend-paginator to the Album Module</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">In-Depth Tutorial</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../in-depth-guide/first-module/">Introducing the Blog Module</a>
</li>

        
            
<li >
    <a href="../in-depth-guide/models-and-servicemanager/">Models and the ServiceManager</a>
</li>

        
            
<li >
    <a href="../in-depth-guide/preparing-databases/">Preparing for Different Databases</a>
</li>

        
            
<li >
    <a href="../in-depth-guide/zend-db-sql-zend-hydrator/">SQL Abstraction and Object Hydration</a>
</li>

        
            
<li >
    <a href="../in-depth-guide/understanding-routing/">Understanding the Router</a>
</li>

        
            
<li >
    <a href="../in-depth-guide/zend-form-zend-form-fieldset/">Making Use of Forms and Fieldsets</a>
</li>

        
            
<li >
    <a href="../in-depth-guide/data-binding/">Editing and Deleting Data</a>
</li>

        
            
<li >
    <a href="../in-depth-guide/review/">Reviewing the Blog Module</a>
</li>

        
    </ul>
  </li>

                        
                            
<li class="active">
    <a href="./">Advanced Configuration</a>
</li>

                        
                            
<li >
    <a href="../i18n/">Internationalization</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Component Tutorials <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../db-adapter/">Setting Up A Database Adapter</a>
</li>

                        
                            
<li >
    <a href="../event-manager/">Using the EventManager</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Migration <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">To Version 3</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../migration/to-v3/overview/">Overview</a>
</li>

        
            
<li >
    <a href="../migration/to-v3/components/">Components</a>
</li>

        
            
<li >
    <a href="../migration/to-v3/application/">Applications</a>
</li>

        
    </ul>
  </li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" class="component-toggle" data-toggle="tooltip" data-placement="bottom" title="Show component list">
                        <i class="fa fa-book"></i> Components
                    </a>
                </li>

                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li>
                        <a href="https://github.com/zendframework/tutorials">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

    <!-- content:begin -->
    <div id="page-top" class="container docs">
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#advanced-configuration-tricks">Advanced Configuration Tricks</a></li>
        
            <li><a href="#system-configuration">System configuration</a></li>
        
            <li><a href="#module-configuration">Module Configuration</a></li>
        
            <li><a href="#configuration-mapping-table">Configuration mapping table</a></li>
        
            <li><a href="#configuration-priority">Configuration Priority</a></li>
        
            <li><a href="#manipulating-merged-configuration">Manipulating merged configuration</a></li>
        
            <li><a href="#configuration-merging-workflow">Configuration merging workflow</a></li>
        
    
    </ul>

    
    <ul class="pager hidden-print">
      <li class="previous">
        <a rel="prev" href="../in-depth-guide/review/"><i class="fa fa-arrow-left"></i> Previous</a>
      </li>
      <li class="next">
        <a rel="next" href="../i18n/">Next <i class="fa fa-arrow-right"></i></a>
      </li>
    </ul>
    
</div></div>
        <div class="col-md-9" role="main">

<ol class="breadcrumb" role="navigation" aria-label="breadcrumbs navigation">
  <li><a href="..">tutorials</a> &raquo;</li>
  
    
      
        <li>MVC Tutorials &raquo;</li>
      
    
  
  <li class="active">Advanced Configuration</li>
</ol>

<h1 id="advanced-configuration-tricks">Advanced Configuration Tricks</h1>
<p>Configuration of zend-mvc applications happens in several steps:</p>
<ul>
<li>Initial configuration is passed to the <code>Application</code> instance and used to seed
  the <code>ModuleManager</code> and <code>ServiceManager</code>. In this tutorial, we will call this
  configuration <strong>system configuration</strong>.</li>
<li>The <code>ModuleManager</code>'s <code>ConfigListener</code> aggregates configuration and merges it
  while modules are being loaded. In this tutorial, we will call this
  configuration <strong>application configuration</strong>.</li>
<li>Once configuration is aggregated from all modules, the <code>ConfigListener</code> will
  also merge application configuration globbed in specified directories
  (typically <code>config/autoload/</code>).</li>
<li>Finally, immediately prior to the merged application configuration being
  passed to the <code>ServiceManager</code>, it is passed to a special <code>EVENT_MERGE_CONFIG</code>
  event to allow further modification.</li>
</ul>
<p>In this tutorial, we'll look at the exact sequence, and how you can tie into it.</p>
<h2 id="system-configuration">System configuration</h2>
<p>To begin module loading, we have to tell the <code>Application</code> instance about the
available modules and where they live, optionally provide some information to
the default module listeners (e.g., where application configuration lives, and
what files to load; whether to cache merged configuration, and where; etc.), and
optionally seed the <code>ServiceManager</code>. For purposes of this tutorial we will call
this the <strong>system configuration</strong>.</p>
<p>When using the skeleton application, the <strong>system configuration</strong> is by default
in <code>config/application.config.php</code>. The defaults look like this:</p>
<pre class="codehilite"><code class="language-php linenums">return [
    // Retrieve list of modules used in this application.
    'modules' =&gt; require __DIR__ . '/modules.config.php',

    // These are various options for the listeners attached to the ModuleManager
    'module_listener_options' =&gt; [
        // This should be an array of paths in which modules reside.
        // If a string key is provided, the listener will consider that a module
        // namespace, the value of that key the specific path to that module's
        // Module class.
        'module_paths' =&gt; [
            './module',
            './vendor',
        ],

        // An array of paths from which to glob configuration files after
        // modules are loaded. These effectively override configuration
        // provided by modules themselves. Paths may use GLOB_BRACE notation.
        'config_glob_paths' =&gt; [
            realpath(__DIR__) . '/autoload/{{,*.}global,{,*.}local}.php',
        ],

        // Whether or not to enable a configuration cache.
        // If enabled, the merged configuration will be cached and used in
        // subsequent requests.
        'config_cache_enabled' =&gt; true,

        // The key used to create the configuration cache file name.
        'config_cache_key' =&gt; 'application.config.cache',

        // Whether or not to enable a module class map cache.
        // If enabled, creates a module class map cache which will be used
        // by in future requests, to reduce the autoloading process.
        'module_map_cache_enabled' =&gt; true,

        // The key used to create the class map cache file name.
        'module_map_cache_key' =&gt; 'application.module.cache',

        // The path in which to cache merged configuration.
        'cache_dir' =&gt; 'data/cache/',

        // Whether or not to enable modules dependency checking.
        // Enabled by default, prevents usage of modules that depend on other modules
        // that weren't loaded.
        // 'check_dependencies' =&gt; true,
    ],

    // Used to create an own service manager. May contain one or more child arrays.
    // 'service_listener_options' =&gt; [
    //     [
    //         'service_manager' =&gt; $stringServiceManagerName,
    //         'config_key'      =&gt; $stringConfigKey,
    //         'interface'       =&gt; $stringOptionalInterface,
    //         'method'          =&gt; $stringRequiredMethodName,
    //     ],
    // ],

    // Initial configuration with which to seed the ServiceManager.
    // Should be compatible with Zend\ServiceManager\Config.
    // 'service_manager' =&gt; [],
];</code></pre>

<p>The system configuration is for the bits and pieces related to the MVC that run
before your application is ready. The configuration is usually brief, and quite
minimal.</p>
<p>Also, system configuration is used <em>immediately</em>, and is not merged with any
other configuration &mdash; which means, with the exception of the values under
the <code>service_manager</code> key, it cannot be overridden by a module.</p>
<p>This leads us to our first trick: how do you provide environment-specific system
configuration?</p>
<h3 id="environment-specific-system-configuration">Environment-specific system configuration</h3>
<p>What happens when you want to change the set of modules you use based on the
environment? Or if the configuration caching should be enabled based on
environment?</p>
<p>It is for this reason that the default system configuration we provide in the
skeleton application is in PHP; providing it in PHP means you can
programmatically manipulate it.</p>
<p>As an example, let's make the following requirements:</p>
<ul>
<li>We want to use the <code>ZendDeveloperTools</code> module in development only.</li>
<li>We want to have configuration caching on in production only.</li>
</ul>
<p><a href="https://github.com/zfcampus/zf-development-mode">zfcampus/zf-development-mode</a>
provides a concise and conventions-based approach to switching between
specifically production and development.  The package is installed by default
with version 3+ skeletons, and can be installed with existing v2 skeletons
using the following:</p>
<pre class="codehilite"><code class="language-bash linenums">$ composer require zfcampus/zf-development-mode</code></pre>

<p>The approach it takes is as follows:</p>
<ul>
<li>The user provides production settings in <code>config/application.config.php</code>.</li>
<li>The user provides development settings in
  <code>config/development.config.php.dist</code> to override bootstrap-level settings
  such as modules and configuration caching, and optionally also in
  <code>config/autoload/development.local.php.dist</code> (to override application
  settings).</li>
<li>The bootstrap script (<code>public/index.php</code>) checks for
  <code>config/development.config.php</code>, and, if found, merges its configuration with
  the application configuration prior to configuring the <code>Application</code> instance.</li>
</ul>
<p>When you execute:</p>
<pre class="codehilite"><code class="language-bash linenums">$ ./vendor/bin/zf-development-mode enable</code></pre>

<p>The <code>.dist</code> files are copied to versions removing the suffix; doing so ensures
they will then be used when invoking the application.</p>
<p>As such, to accomplish our goals, we will do the following:</p>
<ul>
<li>In <code>config/development.config.php.dist</code>, add <code>ZendDeveloperTools</code> to the list
  of modules:</li>
</ul>
<pre class="codehilite"><code class="language-php linenums">'modules' =&gt; [
    'ZendDeveloperTools',
],</code></pre>

<ul>
<li>Also in <code>config/development.config.php.dist</code>, we will disable config caching:</li>
</ul>
<pre class="codehilite"><code class="language-php linenums">'config_cache_enable' =&gt; false,</code></pre>

<ul>
<li>In <code>config/application.config.php</code>, we will enable config caching:</li>
</ul>
<pre class="codehilite"><code class="language-php linenums">'config_cache_enable' =&gt; true,</code></pre>

<p>Enabling development mode now enables the selected module, and disables
configuration caching; disabling development mode enables configuration
caching. (Also, either operation clears the configuration cache.)</p>
<p>If you require additional environments, you can extend zf-development-mode to
address them using the same workflow.</p>
<h3 id="environment-specific-application-configuration">Environment-specific application configuration</h3>
<p>Sometimes you want to change application configuration to load things such as
database adapters, log writers, cache adapters, and more based on the
environment. These are typically managed in the service manager, and may be
defined by modules. You can override them at the application level via
<code>Zend\ModuleManager\Listener\ConfigListener</code>, by specifying a glob path in the
<strong>system configuration</strong> &mdash; the <code>module_listener_options.config_glob_paths</code>
key from the previous examples.</p>
<p>The default value for this is <code>config/autoload/{{,*.}global,{,*.}local}.php</code>.
What this means is that it will look for <strong>application configuration</strong> files in
the <code>config/autoload</code> directory, in the following order:</p>
<ul>
<li><code>global.php</code></li>
<li><code>*.global.php</code></li>
<li><code>local.php</code></li>
<li><code>*.local.php</code></li>
</ul>
<p>This allows you to define application-level defaults in "global" configuration
files, which you would then commit to your version control system, and
environment-specific overrides in your "local" configuration files, which you
would <em>omit</em> from version control.</p>
<blockquote>
<h3 id="additional-glob-patterns-for-development-mode">Additional glob patterns for development mode</h3>
<p>When using zf-development-mode, as detailed in the previous section, the
shipped <code>config/development.config.php.dist</code> file provides an additional
glob pattern for specifying development configuration:</p>
<ul>
<li><code>config/autoload/{,*.}{global,local}-development.php</code></li>
</ul>
<p>This will match files such as:</p>
<ul>
<li>database.global-development.php</li>
<li>database.local-development.php</li>
</ul>
<p>These will only be considered when development mode is enabled!</p>
</blockquote>
<p>This is a great solution for development, as it allows you to specify alternate
configuration that's specific to your development environment without worrying
about accidently deploying it. However, what if you have more environments
&mdash; such as a "testing" or "staging" environment &mdash; and they each have
their own specific overrides?</p>
<p>To accomplish this, we'll provide an <em>environment variable</em> via our web server
configuration, <code>APP_ENV</code>. In Apache, you'd put a directive like the following
in either your system-wide apache.conf or httpd.conf, or in the definition for
your virtual host; alternately, it can be placed in an .htaccess file.</p>
<pre class="codehilite"><code class="language-apacheconf linenums">SetEnv &quot;APP_ENV&quot; &quot;development&quot;</code></pre>

<p>For other web servers, consult the web server documentation to determine how to
set environment variables.</p>
<p>To simplify matters, we'll assume the environment is "production" if no
environment variable is present.</p>
<p>With that in place, We can alter the glob path in the system configuration
slightly:</p>
<pre class="codehilite"><code class="language-php linenums">'config_glob_paths' =&gt; [
    realpath(__DIR__) . sprintf('config/autoload/{,*.}{global,%s,local}.php', getenv('APP_ENV') ?: 'production')
],</code></pre>

<p>The above will allow you to define an additional set of application
configuration files per environment; furthermore, these will be loaded <em>only</em> if
that environment is detected!</p>
<p>As an example, consider the following tree of configuration files:</p>
<pre class="codehilite"><code class="language-text linenums">config/
    autoload/
        global.php
        local.php
        users.development.php
        users.testing.php
        users.local.php</code></pre>

<p>If <code>$env</code> evaluates to <code>testing</code>, then the following files will be merged, in
the following order:</p>
<pre class="codehilite"><code class="language-text linenums">global.php
users.testing.php
local.php
users.local.php</code></pre>

<p>Note that <code>users.development.php</code> is not loaded &mdash; this is because it will
not match the glob pattern!</p>
<p>Also, because of the order in which they are loaded, you can predict which
values will overwrite the others, allowing you to both selectively overwrite as
well as debug later.</p>
<blockquote>
<h4 id="order-of-config-merging">Order of config merging</h4>
<p>The files under <code>config/autoload/</code> are merged <em>after</em> your module
configuration, detailed in next section. We have detailed it here, however, as
setting up the <strong>application configuration</strong> glob path happens within the
<strong>system configuration</strong> (<code>config/application.config.php</code>).</p>
</blockquote>
<h2 id="module-configuration">Module Configuration</h2>
<p>One responsibility of modules is to provide their own configuration to the
application. Modules have two general mechanisms for doing this.</p>
<p><strong>First</strong>, modules that either implement
<code>Zend\ModuleManager\Feature\ConfigProviderInterface</code> and/or a <code>getConfig()</code>
method can return their configuration. The default, recommended implementation
of the <code>getConfig()</code> method is:</p>
<pre class="codehilite"><code class="language-php linenums">public function getConfig()
{
    return include __DIR__ . '/config/module.config.php';
}</code></pre>

<p>where <code>module.config.php</code> returns a PHP array. From that PHP array you can
provide general configuration as well as configuration for all the available
<code>Manager</code> classes provided by the ServiceManager. Please refer to the
<a href="#configuration-mapping-table">Configuration mapping table</a> to see which
configuration key is used for each specific <code>Manager</code>.</p>
<p><strong>Second</strong>, modules can implement a number of interfaces and/or methods related
to specific service manager or plugin manager configuration. You will find an
overview of all interfaces and their matching Module Configuration functions
inside the <a href="#configuration-mapping-table">Configuration mapping table</a>.</p>
<p>Most interfaces are in the <code>Zend\ModuleManager\Feature</code> namespace (some have
moved to the individual components), and each is expected to return an array of
configuration for a service manager, as denoted in the section on
<a href="http://zendframework.github.io/zend-mvc/services/#servicemanager">default service configuration</a>.</p>
<h2 id="configuration-mapping-table">Configuration mapping table</h2>
<div class="table-responsive"><table>
<thead>
<tr>
<th>Manager name</th>
<th>Interface name</th>
<th>Module method name</th>
<th>Config key name</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ControllerPluginManager</code></td>
<td><code>ControllerPluginProviderInterface</code></td>
<td><code>getControllerPluginConfig()</code></td>
<td><code>controller_plugins</code></td>
</tr>
<tr>
<td><code>ControllerManager</code></td>
<td><code>ControllerProviderInterface</code></td>
<td><code>getControllerConfig()</code></td>
<td><code>controllers</code></td>
</tr>
<tr>
<td><code>FilterManager</code></td>
<td><code>FilterProviderInterface</code></td>
<td><code>getFilterConfig()</code></td>
<td><code>filters</code></td>
</tr>
<tr>
<td><code>FormElementManager</code></td>
<td><code>FormElementProviderInterface</code></td>
<td><code>getFormElementConfig()</code></td>
<td><code>form_elements</code></td>
</tr>
<tr>
<td><code>HydratorManager</code></td>
<td><code>HydratorProviderInterface</code></td>
<td><code>getHydratorConfig()</code></td>
<td><code>hydrators</code></td>
</tr>
<tr>
<td><code>InputFilterManager</code></td>
<td><code>InputFilterProviderInterface</code></td>
<td><code>getInputFilterConfig()</code></td>
<td><code>input_filters</code></td>
</tr>
<tr>
<td><code>RoutePluginManager</code></td>
<td><code>RouteProviderInterface</code></td>
<td><code>getRouteConfig()</code></td>
<td><code>route_manager</code></td>
</tr>
<tr>
<td><code>SerializerAdapterManager</code></td>
<td><code>SerializerProviderInterface</code></td>
<td><code>getSerializerConfig()</code></td>
<td><code>serializers</code></td>
</tr>
<tr>
<td><code>ServiceLocator</code></td>
<td><code>ServiceProviderInterface</code></td>
<td><code>getServiceConfig()</code></td>
<td><code>service_manager</code></td>
</tr>
<tr>
<td><code>ValidatorManager</code></td>
<td><code>ValidatorProviderInterface</code></td>
<td><code>getValidatorConfig()</code></td>
<td><code>validators</code></td>
</tr>
<tr>
<td><code>ViewHelperManager</code></td>
<td><code>ViewHelperProviderInterface</code></td>
<td><code>getViewHelperConfig()</code></td>
<td><code>view_helpers</code></td>
</tr>
<tr>
<td><code>LogProcessorManager</code></td>
<td><code>LogProcessorProviderInterface</code></td>
<td><code>getLogProcessorConfig</code></td>
<td><code>log_processors</code></td>
</tr>
<tr>
<td><code>LogWriterManager</code></td>
<td><code>LogWriterProviderInterface</code></td>
<td><code>getLogWriterConfig</code></td>
<td><code>log_writers</code></td>
</tr>
</tbody>
</table></div>
<h2 id="configuration-priority">Configuration Priority</h2>
<p>Considering that you may have service configuration in your module configuration file, what has precedence?</p>
<p>The order in which they are merged is:</p>
<ul>
<li>configuration returned by the various service configuration methods in a module class</li>
<li>configuration returned by <code>getConfig()</code></li>
</ul>
<p>In other words, your <code>getConfig()</code> wins over the various service configuration
methods. Additionally, and of particular note: the configuration returned from
those methods will <em>not</em> be cached.</p>
<blockquote>
<h3 id="use-cases-for-service-configuration-methods">Use cases for service configuration methods</h3>
<p>Use the various service configuration methods when you need to define closures
or instance callbacks for factories, abstract factories, and initializers.
This prevents caching problems, and also allows you to write your
configuration files in other markup formats.</p>
</blockquote>
<h2 id="manipulating-merged-configuration">Manipulating merged configuration</h2>
<p>Occasionally you will want to not just override an application configuration
key, but actually remove it. Since merging will not remove keys, how can you
handle this?</p>
<p><code>Zend\ModuleManager\Listener\ConfigListener</code> triggers a special event,
<code>Zend\ModuleManager\ModuleEvent::EVENT_MERGE_CONFIG</code>, after merging all
configuration, but prior to it being passed to the <code>ServiceManager</code>. By
listening to this event, you can inspect the merged configuration and manipulate
it.</p>
<p>The <code>ConfigListener</code> itself listens to the event at priority 1000 (i.e., very
high), which is when the configuration is merged. You can tie into this to
modify the merged configuration from your module, via the <code>init()</code> method.</p>
<pre class="codehilite"><code class="language-php linenums">namespace Foo;

use Zend\ModuleManager\ModuleEvent;
use Zend\ModuleManager\ModuleManager;

class Module
{
    public function init(ModuleManager $moduleManager)
    {
        $events = $moduleManager-&gt;getEventManager();

        // Registering a listener at default priority, 1, which will trigger
        // after the ConfigListener merges config.
        $events-&gt;attach(ModuleEvent::EVENT_MERGE_CONFIG, [$this, 'onMergeConfig']);
    }

    public function onMergeConfig(ModuleEvent $e)
    {
        $configListener = $e-&gt;getConfigListener();
        $config         = $configListener-&gt;getMergedConfig(false);

        // Modify the configuration; here, we'll remove a specific key:
        if (isset($config['some_key'])) {
            unset($config['some_key']);
        }

        // Pass the changed configuration back to the listener:
        $configListener-&gt;setMergedConfig($config);
    }
}</code></pre>

<p>At this point, the merged application configuration will no longer contain the
key <code>some_key</code>.</p>
<blockquote>
<h3 id="cached-configuration-and-merging">Cached configuration and merging</h3>
<p>If a cached config is used by the <code>ModuleManager</code>, the <code>EVENT_MERGE_CONFIG</code>
event will not be triggered. However, typically that means that what is cached
will be what was originally manipulated by your listener.</p>
</blockquote>
<h2 id="configuration-merging-workflow">Configuration merging workflow</h2>
<p>To cap off the tutorial, let's review how and when configuration is defined and
merged.</p>
<ul>
<li><strong>System configuration</strong></li>
<li>Defined in <code>config/application.config.php</code></li>
<li>No merging occurs</li>
<li>Allows manipulation programmatically, which allows the ability to:<ul>
<li>Alter flags based on computed values</li>
<li>Alter the configuration glob path based on computed values</li>
<li>Configuration is passed to the <code>Application</code> instance, and then the
  <code>ModuleManager</code> in order to initialize the system.</li>
</ul>
</li>
<li><strong>Application configuration</strong></li>
<li>The <code>ModuleManager</code> loops through each module class in the order defined in the <strong>system configuration</strong><ul>
<li>Service configuration defined in <code>Module</code> class methods is aggregated</li>
<li>Configuration returned by <code>Module::getConfig()</code> is aggregated</li>
<li>Files detected from the <strong>service configuration</strong> <code>config_glob_paths</code>
  setting are merged, based on the order they resolve in the glob path.</li>
<li><code>ConfigListener</code> triggers <code>EVENT_MERGE_CONFIG</code>:</li>
<li><code>ConfigListener</code> merges configuration</li>
<li>Any other event listeners manipulate the configuration</li>
<li>Merged configuration is finally passed to the <code>ServiceManager</code></li>
</ul>
</li>
</ul>

<hr />


<nav>
  <ul class="pager hidden-print">
    <li class="previous">
      <a rel="prev" href="../in-depth-guide/review/"><i class="fa fa-arrow-left"></i> Previous</a>
    </li>
    <li class="next">
      <a rel="next" href="../i18n/">Next <i class="fa fa-arrow-right"></i></a>
    </li>
  </ul>
</nav>
</div>
        
    </div>
    <!-- content:end -->

    <div id="footerwrap">
    <div class="container">
        <div class="row site-map">
            <div class="col-lg-3">
              <p>
                <strong>Zend Framework</strong><br />
                <a href="http://framework.zend.com/">framework.zend.com</a><br />
                <a href="https://docs.zendframework.com">docs.zendframework.com</a><br />
                <a href="https://packages.zendframework.com">packages.zendframework.com</a><br />
                <a href="https://apigility.org">apigility.org</a><br />
              </p>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12 centered">
                <a class="back-to-top" href="#page-top"><i class="fa fa-chevron-circle-up fa-4" aria-hidden="true"></i></a>
            </div>
        </div>

        <div class="spacing"></div>

        <div class="row">
            <div class="col-lg-8">
                <h4>Copyright</h4>
                <div class="hline-w"></div>

                <p>&copy; 2006-2016 by <a href="http://www.zend.com">Zend</a>, a <a href="http://www.roguewave.com/">Rogue Wave Company</a>.</p>
            </div>

            <div class="col-lg-4">
                <h4>Contacts</h4>
                <div class="hline-w"></div>
                <p>
                    <a href="irc://irc.freenode.net/zftalk" class="btn-social btn-outline" alt="IRC" title="IRC"><i class="fa fa-comment"></i></a>
                    <a href="https://github.com/zendframework" class="btn-social btn-outline" alt="Github" title="Github"><i class="fa fa-github"></i></a>
                    <a href="https://twitter.com/zfdevteam" class="btn-social btn-outline" alt="Twitter" title="Twitter"><i class="fa fa-twitter"></i></a>
                </p>
            </div>
        </div>
    </div>
</div>


    <script src="../js/jquery-1.10.2.min.js"></script>
    <script src="../js/bootstrap-3.0.3.min.js"></script>
    <script src="../js/prism-zf.js"></script>

    <script>var base_url = '..';</script>
    <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
    <script src="../js/base.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    <div class="zf-components">
  <div class="zf-components-grid">
    <div class="zf-logo">
      <a href="http://framework.zend.com" data-toggle="tooltip" data-placement="bottom" title="Go to the ZF homepage"><img src="../img/zf-logo-mark.svg" alt="Zend Framework" width="250" /></a>
    </div>

    <div class="component-list"></div>

    <p class="zf-components-rollup"><a href="#">Hide list</a></p>
  </div>
</div>

    <script>
  // Prepare the component list dropdown for display
  $(function () {
    var components = $(".zf-components"),
        componentList = components.find(".component-list"),
        sidebar = $(".bs-sidebar.affix"),
        sidebarInitialPos = sidebar.css("position"),
        hidden,
        componentToggle = $(".component-toggle"),
        navbar = $(".navbar-fixed-top"),
        rollUpLink = $(".zf-components-rollup a");

    // Initial setup on document load
    components.insertBefore(navbar);
    $(".zf-logo a").tooltip();
    componentToggle.tooltip();
    rollUpLink.attr({ href: "#", alt: "Hide component list" });

    // Cast initial sidebar position value
    if (undefined === sidebarInitialPos) {
      sidebarInitialPos = "fixed";
    }

    // Setup onclick events to toggle list
    componentToggle.click(toggleComponentList);
    rollUpLink.click(toggleComponentList);

    // Toggle the component list display
    function toggleComponentList(event) {
      event.preventDefault();

      if (hidden === undefined) {
        // Not loaded yet; load and display.
        loadComponentList();
        return;
      }

      if (hidden) {
        // Hidden; display.
        showComponentList();
        return;
      }

      // Currently visible; hide
      hideComponentList();
    }

    // Show the component list
    function showComponentList() {
      navbar.css({position: "relative"});
      sidebar.css({position: "relative"});
      components
        .css({"margin-top": "-" + components.outerHeight() + "px"})
        .show()
        .animate({"margin-top": 0}, {
          complete: function () {
            componentToggle
              .data("placement", "top")
              .attr("data-original-title", "Hide component list");
            hidden = false;
          },
          queue: false
        });
    }

    // Hide the component list
    function hideComponentList() {
      components.animate({"margin-top": "-" + components.outerHeight() + "px"}, {
        complete: function () {
          navbar.css({position: "fixed"});
          sidebar.css({position: sidebarInitialPos});
          componentToggle
            .data("placement", "bottom")
            .attr("data-original-title", "Show component list");
          components.hide();
          hidden = true;
        },
        queue: false
      });
      sidebar.animate({ top: sidebarInitialTop + "px" }, { queue: false});
    }

    // Inject a component into the componet list DOM.
    function injectComponent(index, component) {
      componentList.append('<div class="component"><h4><a href="' + component.url + '">' + component.name + '</a></h4><p>' + component.description + '</p></div>');
    }

    // Parse the component list, build the DOM, and display it.
    function parseComponentList(components) {
      $.each(components, injectComponent);
      showComponentList();
    }

    // Fetch the component list and display it.
    function loadComponentList () {
      $.ajax({
        url: "//docs.zendframework.com/zf-mkdoc-theme/scripts/zf-component-list.json",
        dataType: "text json",
        success: parseComponentList,
        error: function (e) {
          console.log("Error occurred with XHR call", e);
        }
      });
    }
  });
</script>
    </body>

</html>
