<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <link rel="shortcut icon" href="../../img/favicon.ico">

    <title>Models and the ServiceManager - tutorials</title>

    <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/2.018/css/hack.min.css">
    <link href="//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Libre+Baskerville:400,400italic,700&subset=latin,latin-ext" rel="stylesheet" type="text/css">
    <link href="../../css/base.css" rel="stylesheet">
    <link href="../../css/zf-web.css" rel="stylesheet">
    <link href="../../css/zf.css" rel="stylesheet">
    <link href="../../css/prism-zf.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <span class="navbar-brand">
              <a class="logo-link" href="http://framework.zend.com" data-toggle="tooltip" data-placement="bottom" title="Zend Framework"><img src="../../img/zf-logo-mark.svg" height="28" alt="Zend Framework" /></a>
              <a href="../..">tutorials</a>
            </span>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">MVC Tutorials <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Getting Started with Zend Framework</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../getting-started/overview/">Overview</a>
</li>

        
            
<li >
    <a href="../../getting-started/skeleton-application/">The Skeleton Application</a>
</li>

        
            
<li >
    <a href="../../getting-started/modules/">Modules</a>
</li>

        
            
<li >
    <a href="../../getting-started/routing-and-controllers/">Routing and Controllers</a>
</li>

        
            
<li >
    <a href="../../getting-started/database-and-models/">Database and Models</a>
</li>

        
            
<li >
    <a href="../../getting-started/forms-and-actions/">Forms and Actions</a>
</li>

        
            
<li >
    <a href="../../getting-started/conclusion/">Conclusion</a>
</li>

        
    </ul>
  </li>

                        
                            
<li >
    <a href="../../unit-testing/">Unit Testing A zend-mvc Application</a>
</li>

                        
                            
<li >
    <a href="../../navigation/">Adding zend-navigation to the Album Module</a>
</li>

                        
                            
<li >
    <a href="../../pagination/">Adding zend-paginator to the Album Module</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">In-Depth Tutorial</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../first-module/">Introducing the Blog Module</a>
</li>

        
            
<li class="active">
    <a href="./">Models and the ServiceManager</a>
</li>

        
            
<li >
    <a href="../preparing-databases/">Preparing for Different Databases</a>
</li>

        
            
<li >
    <a href="../zend-db-sql-zend-hydrator/">SQL Abstraction and Object Hydration</a>
</li>

        
            
<li >
    <a href="../understanding-routing/">Understanding the Router</a>
</li>

        
            
<li >
    <a href="../zend-form-zend-form-fieldset/">Making Use of Forms and Fieldsets</a>
</li>

        
            
<li >
    <a href="../data-binding/">Editing and Deleting Data</a>
</li>

        
            
<li >
    <a href="../review/">Reviewing the Blog Module</a>
</li>

        
    </ul>
  </li>

                        
                            
<li >
    <a href="../../advanced-config/">Advanced Configuration</a>
</li>

                        
                            
<li >
    <a href="../../i18n/">Internationalization</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Component Tutorials <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../db-adapter/">Setting Up A Database Adapter</a>
</li>

                        
                            
<li >
    <a href="../../event-manager/">Using the EventManager</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Migration <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">To Version 3</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../migration/to-v3/overview/">Overview</a>
</li>

        
            
<li >
    <a href="../../migration/to-v3/components/">Components</a>
</li>

        
            
<li >
    <a href="../../migration/to-v3/application/">Applications</a>
</li>

        
    </ul>
  </li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" class="component-toggle" data-toggle="tooltip" data-placement="bottom" title="Show component list">
                        <i class="fa fa-book"></i> Components
                    </a>
                </li>

                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li>
                        <a href="https://github.com/zendframework/tutorials">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

    <!-- content:begin -->
    <div id="page-top" class="container docs">
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#models-and-the-servicemanager">Models and the ServiceManager</a></li>
        
            <li><a href="#what-is-a-model">What is a Model?</a></li>
        
            <li><a href="#writing-the-postrepository">Writing the PostRepository</a></li>
        
            <li><a href="#create-an-entity">Create an entity</a></li>
        
            <li><a href="#bringing-life-into-our-postrepository">Bringing Life into our PostRepository</a></li>
        
            <li><a href="#bringing-the-service-into-the-controller">Bringing the Service into the Controller</a></li>
        
            <li><a href="#writing-a-factory-class">Writing a Factory Class</a></li>
        
            <li><a href="#registering-services">Registering Services</a></li>
        
            <li><a href="#using-the-repository-in-our-controller">Using the repository in our controller</a></li>
        
            <li><a href="#accessing-view-variables">Accessing View Variables</a></li>
        
            <li><a href="#summary">Summary</a></li>
        
    
    </ul>

    
    <ul class="pager hidden-print">
      <li class="previous">
        <a rel="prev" href="../first-module/"><i class="fa fa-arrow-left"></i> Previous</a>
      </li>
      <li class="next">
        <a rel="next" href="../preparing-databases/">Next <i class="fa fa-arrow-right"></i></a>
      </li>
    </ul>
    
</div></div>
        <div class="col-md-9" role="main">

<ol class="breadcrumb" role="navigation" aria-label="breadcrumbs navigation">
  <li><a href="../..">tutorials</a> &raquo;</li>
  
    
      
        <li>MVC Tutorials &raquo;</li>
      
    
      
        <li>In-Depth Tutorial &raquo;</li>
      
    
  
  <li class="active">Models and the ServiceManager</li>
</ol>

<h1 id="models-and-the-servicemanager">Models and the ServiceManager</h1>
<p>In the previous chapter we've learned how to create a "Hello World" Application
using zend-mvc. This is a good start, but the application itself doesn't really
do anything. In this chapter we will introduce you into the concept of models,
and with this, introduce zend-servicemanager.</p>
<h2 id="what-is-a-model">What is a Model?</h2>
<p>A model encapsulates application logic. This often entails <em>entity</em> or <em>value</em>
objects representing specific <em>things</em> in our model, and <em>repositories</em> for
retrieving and updating these objects.</p>
<p>For what we're trying to accomplish with our <code>Blog</code> module, this means that we
need functionality for retrieving and saving blog posts. The posts themselves
are our entities, and the repository will be what we retrieve them from and save
them with. The model will get its data from some source; when writing the model,
we don't really care about what the source actually is. The model will be
written against an interface that we define and that future data providers must
implement.</p>
<h2 id="writing-the-postrepository">Writing the PostRepository</h2>
<p>When writing a repository, it is a common best-practice to define an interface
first. Interfaces are a good way to ensure that other programmers can easily
build their own implementations. In other words, they can write classes with
identical function names, but which internally do completely different things,
while producing the same expected results.</p>
<p>In our case, we want to create a <code>PostRepository</code>. This means first we are going to
define a <code>PostRepositoryInterface</code>. The task of our repository is to provide us with
data from our blog posts. For now, we are going to focus on the read-only side of
things: we will define a method that will give us all posts, and another method
that will give us a single post.</p>
<p>Let's start by creating the interface at
<code>module/Blog/src/Model/PostRepositoryInterface.php</code></p>
<pre class="codehilite"><code class="language-php linenums">namespace Blog\Model;

interface PostRepositoryInterface
{
    /**
     * Return a set of all blog posts that we can iterate over.
     *
     * Each entry should be a Post instance.
     *
     * @return Post[]
     */
    public function findAllPosts();

    /**
     * Return a single blog post.
     *
     * @param  int $id Identifier of the post to return.
     * @return Post
     */
    public function findPost($id);
}</code></pre>

<p>The first method, <code>findAllPosts()</code>, will return return all posts, and the second
method, <code>findPost($id)</code>, will return the post matching the given identifier
<code>$id</code>. What's new in here is the fact that we actually define a return value
that doesn't exist yet. We will define this class at a later point; for now, we
will create the <code>PostRepository</code> class.</p>
<p>Create the class <code>PostRepository</code> at <code>module/Blog/src/Model/PostRepository.php</code>;
be sure to implement the <code>PostRepositoryInterface</code> and its required method (we
will fill these in later). You then should have a class that looks like the
following:</p>
<pre class="codehilite"><code class="language-php linenums">namespace Blog\Model;

class PostRepository implements PostRepositoryInterface
{
    /**
     * {@inheritDoc}
     */
    public function findAllPosts()
    {
        // TODO: Implement findAllPosts() method.
    }

    /**
     * {@inheritDoc}
     */
    public function findPost($id)
    {
        // TODO: Implement findPost() method.
    }
}</code></pre>

<h2 id="create-an-entity">Create an entity</h2>
<p>Since our <code>PostRepository</code> will return <code>Post</code> instances, we must create that
class, too. Let's create <code>module/Blog/src/Model/Post.php</code>:</p>
<pre class="codehilite"><code class="language-php linenums">namespace Blog\Model;

class Post
{
    /**
     * @var int
     */
    private $id;

    /**
     * @var string
     */
    private $text;

    /**
     * @var string
     */
    private $title;

    /**
     * @param string $title
     * @param string $text
     * @param int|null $id
     */
    public function __construct($title, $text, $id = null)
    {
        $this-&gt;title = $title;
        $this-&gt;text = $text;
        $this-&gt;id = $id;
    }

    /**
     * @return int|null
     */
    public function getId()
    {
        return $this-&gt;id;
    }

    /**
     * @return string
     */
    public function getText()
    {
        return $this-&gt;text;
    }

    /**
     * @return string
     */
    public function getTitle()
    {
        return $this-&gt;title;
    }
}</code></pre>

<p>Notice that we only created getter methods; this is because each instance should
be unchangeable, allowing us to cache instances in the repository as necessary.</p>
<h2 id="bringing-life-into-our-postrepository">Bringing Life into our PostRepository</h2>
<p>Now that we have our entity in place, we can bring life into our
<code>PostRepository</code> class. To keep the repository easy to understand, for now we
will only return some hard-coded content from our <code>PostRepository</code> class directly.
Create a property inside the <code>PostRepository</code> called <code>$data</code> and make this an array
of our <code>Post</code> type. Edit <code>PostReepository</code> as follows:</p>
<pre class="codehilite"><code class="language-php linenums">namespace Blog\Model;

class PostRepository implements PostRepositoryInterface
{
    private $data = [
        1 =&gt; [
            'id'    =&gt; 1,
            'title' =&gt; 'Hello World #1',
            'text'  =&gt; 'This is our first blog post!',
        ],
        2 =&gt; [
            'id'    =&gt; 2,
            'title' =&gt; 'Hello World #2',
            'text'  =&gt; 'This is our second blog post!',
        ],
        3 =&gt; [
            'id'    =&gt; 3,
            'title' =&gt; 'Hello World #3',
            'text'  =&gt; 'This is our third blog post!',
        ],
        4 =&gt; [
            'id'    =&gt; 4,
            'title' =&gt; 'Hello World #4',
            'text'  =&gt; 'This is our fourth blog post!',
        ],
        5 =&gt; [
            'id'    =&gt; 5,
            'title' =&gt; 'Hello World #5',
            'text'  =&gt; 'This is our fifth blog post!',
        ],
    ];

    /**
     * {@inheritDoc}
     */
    public function findAllPosts()
    {
        // TODO: Implement findAllPosts() method.
    }

    /**
     * {@inheritDoc}
     */
    public function findPost($id)
    {
        // TODO: Implement findPost() method.
    }
}</code></pre>

<p>Now that we have some data, let's modify our <code>find*()</code> functions to return the
appropriate entities:</p>
<pre class="codehilite"><code class="language-php linenums">namespace Blog\Model;

use DomainException;

class PostRepository implements PostRepositoryInterface
{
    private $data = [
        1 =&gt; [
            'id'    =&gt; 1,
            'title' =&gt; 'Hello World #1',
            'text'  =&gt; 'This is our first blog post!',
        ],
        2 =&gt; [
            'id'    =&gt; 2,
            'title' =&gt; 'Hello World #2',
            'text'  =&gt; 'This is our second blog post!',
        ],
        3 =&gt; [
            'id'    =&gt; 3,
            'title' =&gt; 'Hello World #3',
            'text'  =&gt; 'This is our third blog post!',
        ],
        4 =&gt; [
            'id'    =&gt; 4,
            'title' =&gt; 'Hello World #4',
            'text'  =&gt; 'This is our fourth blog post!',
        ],
        5 =&gt; [
            'id'    =&gt; 5,
            'title' =&gt; 'Hello World #5',
            'text'  =&gt; 'This is our fifth blog post!',
        ],
    ];

    /**
     * {@inheritDoc}
     */
    public function findAllPosts()
    {
        return array_map(function ($post) {
            return new Post(
                $post['title'],
                $post['text'],
                $post['id']
            );
        }, $this-&gt;data);
    }

    /**
     * {@inheritDoc}
     */
    public function findPost($id)
    {
        if (! isset($this-&gt;data[$id])) {
            throw new DomainException(sprintf('Post by id &quot;%s&quot; not found', $id));
        }

        return new Post(
            $this-&gt;data[$id]['title'],
            $this-&gt;data[$id]['text'],
            $this-&gt;data[$id]['id']
        );
    }
}</code></pre>

<p>Both methods now have appropriate return values. Please note that from a
technical point of view, the current implementation is far from perfect. We will
improve this repository in the future, but for now we have a working repository
that is able to give us some data in a way that is defined by our
<code>PostRepositoryInterface</code>.</p>
<h2 id="bringing-the-service-into-the-controller">Bringing the Service into the Controller</h2>
<p>Now that we have our <code>PostRepository</code> written, we want to get access to this
repository in our controllers. For this task, we will step foot into a new topic
called "Dependency Injection" (DI).</p>
<p>When we're talking about dependency injection, we're talking about a way to get
dependencies into our classes. The most common form, "Constructor Injection", is
used for all dependencies that are required by a class at all times.</p>
<p>In our case, we want to have our <code>ListController</code> somehow interact with our
<code>PostRepository</code>. This means that the class <code>PostRepository</code> is a dependency of
the class <code>ListController</code>; without the <code>PostRepository</code>, our <code>ListController</code>
will not be able to function properly. To make sure that our <code>ListController</code>
will always get the appropriate dependency, we will first define the dependency
inside the <code>ListController</code> constructor. Modify <code>ListController</code> as follows:</p>
<pre class="codehilite"><code class="language-php linenums">namespace Blog\Controller;

use Blog\Model\PostRepositoryInterface;
use Zend\Mvc\Controller\AbstractActionController;

class ListController extends AbstractActionController
{
    /**
     * @var PostRepositoryInterface
     */
    private $postRepository;

    public function __construct(PostRepositoryInterface $postRepository)
    {
        $this-&gt;postRepository = $postRepository;
    }
}</code></pre>

<p>The constructor now has a required argument; we will not be able to create
instances of this class anymore without providing a <code>PostRepositoryInterface</code>
implementation. If you were to go back to your browser and reload your project
with the url <code>localhost:8080/blog</code>, you'd see the following error message:</p>
<pre class="codehilite"><code class="language-text linenums">Catchable fatal error: Argument 1 passed to Blog\Controller\ListController::__construct()
must be an instance of Blog\Model\PostRepositoryInterface, none given,
called in {projectPath}/vendor/zendframework/src/Factory/InvokableFactory.php on line {lineNumber}
and defined in {projectPath}/module/Blog/src/Controller/ListController.php on line {lineNumber}</code></pre>

<p>And this error message is expected. It tells you exactly that our
<code>ListController</code> expects to be passed an implementation of the
<code>PostRepositoryInterface</code>. So how do we make sure that our <code>ListController</code> will
receive such an implementation? To solve this, we need to tell the application
how to create instances of the <code>Blog\Controller\ListController</code>. If you remember
back to when we created the controller, we mapped it to the <code>InvokableFactory</code>
in the module configuration:</p>
<pre class="codehilite"><code class="language-php linenums">// In module/Blog/config/module.config.php:
namespace Blog;

use Zend\ServiceManager\Factory\InvokableFactory;

return [
    'controllers'  =&gt; [
        'factories' =&gt; [
            Controller\ListController::class =&gt; InvokableFactory::class,
        ],
    ],
    'router' =&gt; [ /** Router Config */ ]
    'view_manager' =&gt; [ /** ViewManager Config */ ],
);</code></pre>

<p>The <code>InvokableFactory</code> instantiates the mapped class using no constructor
arguments.  Since our <code>ListController</code> now has a required argument, we need to
change this. We will now create a custom factory for our <code>ListController</code>.
First, update the configuration as follows:</p>
<pre class="codehilite"><code class="language-php linenums">// In module/Blog/config/module.config.php:
namespace Blog;

// Remove the InvokableFactory import statement

return [
    'controllers' =&gt; [
        'factories' =&gt; [
            // Update the following line:
            Controller\ListController::class =&gt; Factory\ListControllerFactory::class,
        ],
    ],
    'router' =&gt; [ /** Router Config */ ]
    'view_manager' =&gt; [ /** ViewManager Config */ ],
);</code></pre>

<p>The above changes the mapping for the <code>ListController</code> to use a new factory
class we'll be creating, <code>Blog\Factory\ListControllerFactory</code>.  If you refresh
your browser you'll see a different error message:</p>
<pre class="codehilite"><code class="language-html linenums">An error occurred

An error occurred during execution; please try again later.

Additional information:

Zend\ServiceManager\Exception\ServiceNotFoundException

File:
{projectPath}/zendframework/zend-servicemanager/src/ServiceManager.php:{lineNumber}

Message:

Unable to resolve service &quot;Blog\Controller\ListController&quot; to a factory; are you
certain you provided it during configuration?</code></pre>

<p>This exception message indicates that the service container could not resolve
the service to a factory, and asks if we provided it during configuration. We
did, so the end result is that the factory must not exist. Let's write the
factory now.</p>
<h2 id="writing-a-factory-class">Writing a Factory Class</h2>
<p>Factory classes for zend-servicemanager may implement either
<code>Zend\ServiceManager\Factory\FactoryInterface</code>, or be callable classes (classes
that implement the <code>__invoke()</code> method); <code>FactoryInterface</code> itself defines the
<code>__invoke()</code> method. The first argument is the application container, and is
required; if you implement the <code>FactoryInterface</code>, you must also define a second
argument, <code>$requestedName</code>, which is the service name mapping to the factory,
and an optional third argument, <code>$options</code>, which will be any options provided
by the controller manager at instantiation. In most situations, the last
argument can be ignored; however, you can create re-usable factories by
implementing the second argument, so this is a good one to consider when writing
your factories! For our purposes, this is a one-off factory, so we'll only use
the first argument. Let's implement our factory class:</p>
<pre class="codehilite"><code class="language-php linenums">// In /module/Blog/src/Factory/ListControllerFactory.php:
namespace Blog\Factory;

use Blog\Controller\ListController;
use Blog\Model\PostRepositoryInterface;
use Interop\Container\ContainerInterface;
use Zend\ServiceManager\Factory\FactoryInterface;

class ListControllerFactory implements FactoryInterface
{
    /**
     * @param ContainerInterface $container
     * @param string $requestedName
     * @param null|array $options
     * @return ListController
     */
    public function __invoke(ContainerInterface $container, $requestedName, array $options = null)
    {
        return new ListController($container-&gt;get(PostRepositoryInterface::class));
    }
}</code></pre>

<p>The factory receives an instance of the application container, which, in our
case, is a <code>Zend\ServiceManager\ServiceManager</code> instance; these also conform to
<code>Interop\Container\ContainerInterface</code>, allowing re-use in other dependency
injection systems if desired. We pull a service matching the
<code>PostRepositoryInterface</code> fully qualified class name and pass it directly to the
controller's constructor.</p>
<p>There's no magic happening; it's just PHP code. </p>
<p>Refresh your browser and you will see this error message:</p>
<pre class="codehilite"><code class="language-text linenums">An error occurred

An error occurred during execution; please try again later.

Additional information:

Zend\ServiceManager\Exception\ServiceNotFoundException

File:
{projectPath}/vendor/zendframework/zend-servicemanager/src/ServiceManager.php:{lineNumber}

Message:

Unable to resolve service &quot;Blog\Model\PostRepositoryInterface&quot; to a factory; are
you certain you provided it during configuration?</code></pre>

<p>Exactly what we expected. Within our factory, the service
<code>Blog\Model\PostRepositoryInterface</code> is requested but the <code>ServiceManager</code>
doesn't know about it yet. Therefore it isn't able to create an instance for the
requested name.</p>
<h2 id="registering-services">Registering Services</h2>
<p>Registering other services follows the same pattern as registering a controller.
We will modify our <code>module.config.php</code> and add a new key
called <code>service_manager</code>; the configuration of this key is the same as that for
the <code>controllers</code> key. We will add two entries, one for <code>aliases</code> and one for
<code>factories</code>, as follows:</p>
<pre class="codehilite"><code class="language-php linenums">// In module/Blog/config/module.config.php
namespace Blog;

// Re-add the following import:
use Zend\ServiceManager\Factory\InvokableFactory;

return [
    // Add this section:
    'service_manager' =&gt; [
        'aliases' =&gt; [
            Model\PostRepositoryInterface::class =&gt; Model\PostRepository::class,
        ],
        'factories' =&gt; [
            Model\PostRepository::class =&gt; InvokableFactory::class,
        ],
    ],
    'controllers'  =&gt; [ /** Controller Config */ ],
    'router'       =&gt; [ /** Router Config */ ],
    'view_manager' =&gt; [ /** View Manager Config */ ],
];</code></pre>

<p>This aliases <code>PostRepositoryInterface</code> to our <code>PostRepository</code> implementation,
and then creates a factory for the <code>PostRepository</code> class by mapping it to the
<code>InvokableFactory</code> (like we originally did for the <code>ListController</code>); we can do
this as our <code>PostRepository</code> implementation has no dependencies of its own.</p>
<p>Try refreshing your browser. You should see no more error messages, but rather
exactly the page that we have created in the previous chapter of the tutorial.</p>
<h2 id="using-the-repository-in-our-controller">Using the repository in our controller</h2>
<p>Let's now use the <code>PostRepository</code> within our <code>ListController</code>. For this we will
need to overwrite the default <code>indexAction()</code> and return a view with the results
from the <code>PostRepository</code>. Modify <code>ListController</code> as follows:</p>
<pre class="codehilite"><code class="language-php linenums">// In module/Blog/src/Controller/ListController.php:
namespace Blog\Controller;

use Blog\Model\PostRepositoryInterface;
use Zend\Mvc\Controller\AbstractActionController;
// Add the following import statement:
use Zend\View\Model\ViewModel;

class ListController extends AbstractActionController
{
    /**
     * @var PostRepositoryInterface
     */
    private $postRepository;

    public function __construct(PostRepositoryInterface $postRepository)
    {
        $this-&gt;postRepository = $postRepository;
    }

    // Add the following method:
    public function indexAction()
    {
        return new ViewModel([
            'posts' =&gt; $this-&gt;postRepository-&gt;findAllPosts(),
        ]);
    }
}</code></pre>

<p>First, please note that our controller imported another class,
<code>Zend\View\Model\ViewModel</code>; this is what controllers will usually return within
zend-mvc applications. <code>ViewModel</code> instances allow you to provide variables to
render within your template, as well as indicate which template to use.  In this
case we have assigned a variable called <code>$posts</code> with the value of whatever the
repository method <code>findAllPosts()</code> returns (an array of <code>Post</code> instances).
Refreshing the browser won't change anything yet because we haven't updated our
template to display the data.</p>
<blockquote>
<h3 id="viewmodels-are-not-required">ViewModels are not required</h3>
<p>You do not actually need to return an instance of <code>ViewModel</code>; when you return
a normal PHP array, zend-mvc internally converts it into a <code>ViewModel</code>. The
following are equivalent:</p>
<pre class="codehilite"><code class="language-php linenums">// Explicit ViewModel:
return new ViewModel(['foo' =&gt; 'bar']);

// Implicit ViewModel:
return ['foo' =&gt; 'bar'];</code></pre>

</blockquote>
<h2 id="accessing-view-variables">Accessing View Variables</h2>
<p>When pushing variables to the view, they are accessible in two ways: either
using object notation (<code>$this-&gt;posts</code>) or implicitly as script-level variables
<code>$posts</code>). The two approaches are equivalent; however, calling <code>$posts</code> results
in a little round-trip through the renderer's <code>__get()</code> method. We often
recommend using <code>$this</code> notation to visually differentiate between variables
passed to the view, and those created within the script itself.</p>
<p>Let's modify our view to display a table of all blog posts that our repository
returns:</p>
<pre class="codehilite"><code class="language-php linenums">&lt;!-- Filename: module/Blog/view/blog/list/index.phtml --&gt;
&lt;h1&gt;Blog&lt;/h1&gt;

&lt;?php foreach ($this-&gt;posts as $post): ?&gt;
&lt;article&gt;
  &lt;h1 id=&quot;post&lt;?= $post-&gt;getId() ?&gt;&quot;&gt;&lt;?= $post-&gt;getTitle() ?&gt;&lt;/h1&gt;

  &lt;p&gt;&lt;?= $post-&gt;getText() ?&gt;&lt;/p&gt;
&lt;/article&gt;
&lt;?php endforeach ?&gt;</code></pre>

<p>In the view script, we iterate over the posts passed to the view model.  Since
every single entry of our array is of type <code>Blog\Model\Post</code>, we can use its
getter methods and render it.</p>
<p>After saving this file, refresh your browser, and you should now see a list of
blog entries!</p>
<h2 id="summary">Summary</h2>
<p>In this chapter, we learned:</p>
<ul>
<li>An approach to building the models for an application.</li>
<li>A little bit about dependency injection.</li>
<li>How to use zend-servicemanager to implement dependency injection in zend-mvc
  applications.</li>
<li>How to pass variables to view scripts from the controller.</li>
</ul>
<p>In the next chapter, we will take a first look at the things we should do when
we want to get data from a database.</p>

<hr />


<nav>
  <ul class="pager hidden-print">
    <li class="previous">
      <a rel="prev" href="../first-module/"><i class="fa fa-arrow-left"></i> Previous</a>
    </li>
    <li class="next">
      <a rel="next" href="../preparing-databases/">Next <i class="fa fa-arrow-right"></i></a>
    </li>
  </ul>
</nav>
</div>
        
    </div>
    <!-- content:end -->

    <div id="footerwrap">
    <div class="container">
        <div class="row site-map">
            <div class="col-lg-3">
              <p>
                <strong>Zend Framework</strong><br />
                <a href="http://framework.zend.com/">framework.zend.com</a><br />
                <a href="https://docs.zendframework.com">docs.zendframework.com</a><br />
                <a href="https://packages.zendframework.com">packages.zendframework.com</a><br />
                <a href="https://apigility.org">apigility.org</a><br />
              </p>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12 centered">
                <a class="back-to-top" href="#page-top"><i class="fa fa-chevron-circle-up fa-4" aria-hidden="true"></i></a>
            </div>
        </div>

        <div class="spacing"></div>

        <div class="row">
            <div class="col-lg-8">
                <h4>Copyright</h4>
                <div class="hline-w"></div>

                <p>&copy; 2006-2016 by <a href="http://www.zend.com">Zend</a>, a <a href="http://www.roguewave.com/">Rogue Wave Company</a>.</p>
            </div>

            <div class="col-lg-4">
                <h4>Contacts</h4>
                <div class="hline-w"></div>
                <p>
                    <a href="irc://irc.freenode.net/zftalk" class="btn-social btn-outline" alt="IRC" title="IRC"><i class="fa fa-comment"></i></a>
                    <a href="https://github.com/zendframework" class="btn-social btn-outline" alt="Github" title="Github"><i class="fa fa-github"></i></a>
                    <a href="https://twitter.com/zfdevteam" class="btn-social btn-outline" alt="Twitter" title="Twitter"><i class="fa fa-twitter"></i></a>
                </p>
            </div>
        </div>
    </div>
</div>


    <script src="../../js/jquery-1.10.2.min.js"></script>
    <script src="../../js/bootstrap-3.0.3.min.js"></script>
    <script src="../../js/prism-zf.js"></script>

    <script>var base_url = '../..';</script>
    <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
    <script src="../../js/base.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    <div class="zf-components">
  <div class="zf-components-grid">
    <div class="zf-logo">
      <a href="http://framework.zend.com" data-toggle="tooltip" data-placement="bottom" title="Go to the ZF homepage"><img src="../../img/zf-logo-mark.svg" alt="Zend Framework" width="250" /></a>
    </div>

    <div class="component-list"></div>

    <p class="zf-components-rollup"><a href="#">Hide list</a></p>
  </div>
</div>

    <script>
  // Prepare the component list dropdown for display
  $(function () {
    var components = $(".zf-components"),
        componentList = components.find(".component-list"),
        sidebar = $(".bs-sidebar.affix"),
        sidebarInitialPos = sidebar.css("position"),
        hidden,
        componentToggle = $(".component-toggle"),
        navbar = $(".navbar-fixed-top"),
        rollUpLink = $(".zf-components-rollup a");

    // Initial setup on document load
    components.insertBefore(navbar);
    $(".zf-logo a").tooltip();
    componentToggle.tooltip();
    rollUpLink.attr({ href: "#", alt: "Hide component list" });

    // Cast initial sidebar position value
    if (undefined === sidebarInitialPos) {
      sidebarInitialPos = "fixed";
    }

    // Setup onclick events to toggle list
    componentToggle.click(toggleComponentList);
    rollUpLink.click(toggleComponentList);

    // Toggle the component list display
    function toggleComponentList(event) {
      event.preventDefault();

      if (hidden === undefined) {
        // Not loaded yet; load and display.
        loadComponentList();
        return;
      }

      if (hidden) {
        // Hidden; display.
        showComponentList();
        return;
      }

      // Currently visible; hide
      hideComponentList();
    }

    // Show the component list
    function showComponentList() {
      navbar.css({position: "relative"});
      sidebar.css({position: "relative"});
      components
        .css({"margin-top": "-" + components.outerHeight() + "px"})
        .show()
        .animate({"margin-top": 0}, {
          complete: function () {
            componentToggle
              .data("placement", "top")
              .attr("data-original-title", "Hide component list");
            hidden = false;
          },
          queue: false
        });
    }

    // Hide the component list
    function hideComponentList() {
      components.animate({"margin-top": "-" + components.outerHeight() + "px"}, {
        complete: function () {
          navbar.css({position: "fixed"});
          sidebar.css({position: sidebarInitialPos});
          componentToggle
            .data("placement", "bottom")
            .attr("data-original-title", "Show component list");
          components.hide();
          hidden = true;
        },
        queue: false
      });
      sidebar.animate({ top: sidebarInitialTop + "px" }, { queue: false});
    }

    // Inject a component into the componet list DOM.
    function injectComponent(index, component) {
      componentList.append('<div class="component"><h4><a href="' + component.url + '">' + component.name + '</a></h4><p>' + component.description + '</p></div>');
    }

    // Parse the component list, build the DOM, and display it.
    function parseComponentList(components) {
      $.each(components, injectComponent);
      showComponentList();
    }

    // Fetch the component list and display it.
    function loadComponentList () {
      $.ajax({
        url: "//docs.zendframework.com/zf-mkdoc-theme/scripts/zf-component-list.json",
        dataType: "text json",
        success: parseComponentList,
        error: function (e) {
          console.log("Error occurred with XHR call", e);
        }
      });
    }
  });
</script>
    </body>

</html>
