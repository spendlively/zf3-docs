<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <link rel="shortcut icon" href="../../img/favicon.ico">

    <title>Editing and Deleting Data - tutorials</title>

    <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/2.018/css/hack.min.css">
    <link href="//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Libre+Baskerville:400,400italic,700&subset=latin,latin-ext" rel="stylesheet" type="text/css">
    <link href="../../css/base.css" rel="stylesheet">
    <link href="../../css/zf-web.css" rel="stylesheet">
    <link href="../../css/zf.css" rel="stylesheet">
    <link href="../../css/prism-zf.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <span class="navbar-brand">
              <a class="logo-link" href="http://framework.zend.com" data-toggle="tooltip" data-placement="bottom" title="Zend Framework"><img src="../../img/zf-logo-mark.svg" height="28" alt="Zend Framework" /></a>
              <a href="../..">tutorials</a>
            </span>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">MVC Tutorials <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Getting Started with Zend Framework</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../getting-started/overview/">Overview</a>
</li>

        
            
<li >
    <a href="../../getting-started/skeleton-application/">The Skeleton Application</a>
</li>

        
            
<li >
    <a href="../../getting-started/modules/">Modules</a>
</li>

        
            
<li >
    <a href="../../getting-started/routing-and-controllers/">Routing and Controllers</a>
</li>

        
            
<li >
    <a href="../../getting-started/database-and-models/">Database and Models</a>
</li>

        
            
<li >
    <a href="../../getting-started/forms-and-actions/">Forms and Actions</a>
</li>

        
            
<li >
    <a href="../../getting-started/conclusion/">Conclusion</a>
</li>

        
    </ul>
  </li>

                        
                            
<li >
    <a href="../../unit-testing/">Unit Testing A zend-mvc Application</a>
</li>

                        
                            
<li >
    <a href="../../navigation/">Adding zend-navigation to the Album Module</a>
</li>

                        
                            
<li >
    <a href="../../pagination/">Adding zend-paginator to the Album Module</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">In-Depth Tutorial</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../first-module/">Introducing the Blog Module</a>
</li>

        
            
<li >
    <a href="../models-and-servicemanager/">Models and the ServiceManager</a>
</li>

        
            
<li >
    <a href="../preparing-databases/">Preparing for Different Databases</a>
</li>

        
            
<li >
    <a href="../zend-db-sql-zend-hydrator/">SQL Abstraction and Object Hydration</a>
</li>

        
            
<li >
    <a href="../understanding-routing/">Understanding the Router</a>
</li>

        
            
<li >
    <a href="../zend-form-zend-form-fieldset/">Making Use of Forms and Fieldsets</a>
</li>

        
            
<li class="active">
    <a href="./">Editing and Deleting Data</a>
</li>

        
            
<li >
    <a href="../review/">Reviewing the Blog Module</a>
</li>

        
    </ul>
  </li>

                        
                            
<li >
    <a href="../../advanced-config/">Advanced Configuration</a>
</li>

                        
                            
<li >
    <a href="../../i18n/">Internationalization</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Component Tutorials <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../db-adapter/">Setting Up A Database Adapter</a>
</li>

                        
                            
<li >
    <a href="../../event-manager/">Using the EventManager</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Migration <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">To Version 3</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../migration/to-v3/overview/">Overview</a>
</li>

        
            
<li >
    <a href="../../migration/to-v3/components/">Components</a>
</li>

        
            
<li >
    <a href="../../migration/to-v3/application/">Applications</a>
</li>

        
    </ul>
  </li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" class="component-toggle" data-toggle="tooltip" data-placement="bottom" title="Show component list">
                        <i class="fa fa-book"></i> Components
                    </a>
                </li>

                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li>
                        <a href="https://github.com/zendframework/tutorials">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

    <!-- content:begin -->
    <div id="page-top" class="container docs">
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#editing-and-deleting-data">Editing and Deleting Data</a></li>
        
            <li><a href="#binding-objects-to-forms">Binding Objects to Forms</a></li>
        
            <li><a href="#adding-the-edit-route">Adding the edit route</a></li>
        
            <li><a href="#creating-the-edit-template">Creating the edit template</a></li>
        
            <li><a href="#implementing-the-delete-functionality">Implementing the delete functionality</a></li>
        
            <li><a href="#making-the-list-more-useful">Making the list more useful</a></li>
        
            <li><a href="#summary">Summary</a></li>
        
    
    </ul>

    
    <ul class="pager hidden-print">
      <li class="previous">
        <a rel="prev" href="../zend-form-zend-form-fieldset/"><i class="fa fa-arrow-left"></i> Previous</a>
      </li>
      <li class="next">
        <a rel="next" href="../review/">Next <i class="fa fa-arrow-right"></i></a>
      </li>
    </ul>
    
</div></div>
        <div class="col-md-9" role="main">

<ol class="breadcrumb" role="navigation" aria-label="breadcrumbs navigation">
  <li><a href="../..">tutorials</a> &raquo;</li>
  
    
      
        <li>MVC Tutorials &raquo;</li>
      
    
      
        <li>In-Depth Tutorial &raquo;</li>
      
    
  
  <li class="active">Editing and Deleting Data</li>
</ol>

<h1 id="editing-and-deleting-data">Editing and Deleting Data</h1>
<p>In the previous chapter we've come to learn how we can use the zend-form and
zend-db components for <em>creating</em> new data-sets. This chapter will focus on
finalizing the CRUD functionality by introducing the concepts for <em>editing</em> and
<em>deleting</em> data.</p>
<h2 id="binding-objects-to-forms">Binding Objects to Forms</h2>
<p>The one fundamental difference between our "add post" and "edit post" forms is
the existence of data.  This means we need to find a way to get data from our
repository into the form. Luckily, zend-form provides this via a
<strong>data-binding</strong> feature.</p>
<p>In order to use this feature, you will need to retrieve a <code>Post</code> instance, and
bind it to the form. To do this, we will need to:</p>
<ul>
<li>Add a dependency in our <code>WriteController</code> on our <code>PostRepositoryInterface</code>,
  from which we will retrieve our <code>Post</code>.</li>
<li>Add a new method to our <code>WriteController</code>, <code>editAction()</code>, that will retrieve
  a <code>Post</code>, bind it to the form, and either display the form or process it.</li>
<li>Update our <code>WriteControllerFactory</code> to inject the <code>PostRepositoryInterface</code>.</li>
</ul>
<p>We'll begin by updating the <code>WriteController</code>:</p>
<ul>
<li>We will import the <code>PostRepositoryInterface</code>.</li>
<li>We will add a property for storing the <code>PostRepositoryInterface</code>.</li>
<li>We will update the constructor to accept the <code>PostRepositoryInterface</code>.</li>
<li>We will add the <code>editAction()</code> implementation.</li>
</ul>
<p>The final result will look like the following:</p>
<pre class="codehilite"><code class="language-php linenums">&lt;?php
// In module/Blog/src/Controller/WriteController.php:

namespace Blog\Controller;

use Blog\Form\PostForm;
use Blog\Model\Post;
use Blog\Model\PostCommandInterface;
use Blog\Model\PostRepositoryInterface;
use InvalidArgumentException;
use Zend\Mvc\Controller\AbstractActionController;
use Zend\View\Model\ViewModel;

class WriteController extends AbstractActionController
{
    /**
     * @var PostCommandInterface
     */
    private $command;

    /**
     * @var PostForm
     */
    private $form;

    /**
     * @var PostRepositoryInterface
     */
    private $repository;

    /**
     * @param PostCommandInterface $command
     * @param PostForm $form
     * @param PostRepositoryInterface $repository
     */
    public function __construct(
        PostCommandInterface $command,
        PostForm $form,
        PostRepositoryInterface $repository
    ) {
        $this-&gt;command = $command;
        $this-&gt;form = $form;
        $this-&gt;repository = $repository;
    }

    public function addAction()
    {
        $request   = $this-&gt;getRequest();
        $viewModel = new ViewModel(['form' =&gt; $this-&gt;form]);

        if (! $request-&gt;isPost()) {
            return $viewModel;
        }

        $this-&gt;form-&gt;setData($request-&gt;getPost());

        if (! $this-&gt;form-&gt;isValid()) {
            return $viewModel;
        }

        $post = $this-&gt;form-&gt;getData();

        try {
            $post = $this-&gt;command-&gt;insertPost($post);
        } catch (\Exception $ex) {
            // An exception occurred; we may want to log this later and/or
            // report it to the user. For now, we'll just re-throw.
            throw $ex;
        }

        return $this-&gt;redirect()-&gt;toRoute(
            'blog/detail',
            ['id' =&gt; $post-&gt;getId()]
        );
    }

    public function editAction()
    {
        $id = $this-&gt;params()-&gt;fromRoute('id');
        if (! $id) {
            return $this-&gt;redirect()-&gt;toRoute('blog');
        }

        try {
            $post = $this-&gt;repository-&gt;findPost($id);
        } catch (InvalidArgumentException $ex) {
            return $this-&gt;redirect()-&gt;toRoute('blog');
        }

        $this-&gt;form-&gt;bind($post);
        $viewModel = new ViewModel(['form' =&gt; $this-&gt;form]);

        $request = $this-&gt;getRequest();
        if (! $request-&gt;isPost()) {
            return $viewModel;
        }

        $this-&gt;form-&gt;setData($request-&gt;getPost());

        if (! $this-&gt;form-&gt;isValid()) {
            return $viewModel;
        }

        $post = $this-&gt;command-&gt;updatePost($post);
        return $this-&gt;redirect()-&gt;toRoute(
            'blog/detail',
            ['id' =&gt; $post-&gt;getId()]
        );
    }
}</code></pre>

<p>The primary differences between <code>addAction()</code> and <code>editAction()</code> are that the
latter needs to first fetch a <code>Post</code>, and this post is <em>bound</em> to the form. By
binding it, we ensure that the data is populated in the form for the initial
display, and, once validated, the same instance is updated. This means that we
can omit the call to <code>getData()</code> after validating the form.</p>
<p>Now we need to update our <code>WriteControllerFactory</code>. First, add a new import
statement to it:</p>
<pre class="codehilite"><code class="language-php linenums">// In module/Blog/src/Factory/WriteControllerFactory.php:
use Blog\Model\PostRepositoryInterface;</code></pre>

<p>Next, update the body of the factory to read as follows:</p>
<pre class="codehilite"><code class="language-php linenums">// In module/Blog/src/Factory/WriteControllerFactory.php:
public function __invoke(ContainerInterface $container, $requestedName, array $options = null)
{
    $formManager = $container-&gt;get('FormElementManager');

    return new WriteController(
        $container-&gt;get(PostCommandInterface::class),
        $formManager-&gt;get(PostForm::class),
        $container-&gt;get(PostRepositoryInterface::class)
    );
}</code></pre>

<p>The controller and model are now wired together, so it's time to turn to
routing.</p>
<h2 id="adding-the-edit-route">Adding the edit route</h2>
<p>The edit route is identical to the <code>blog/detail</code> route we previously defined,
with two exceptions:</p>
<ul>
<li>it will have a path prefix, <code>/edit</code></li>
<li>it will route to our <code>WriteController</code></li>
</ul>
<p>Update the 'blog' <code>child_routes</code> to add the new route:</p>
<pre class="codehilite"><code class="language-php linenums">// In module/Blog/config/module.config.php:

use Zend\Router\Http\Segment;

return [
    'service_manager' =&gt; [ /* ... */ ],
    'controllers'     =&gt; [ /* ... */ ],
    'router'          =&gt; [
        'routes' =&gt; [
            'blog' =&gt; [
                /* ... */

                'child_routes' =&gt; [
                    /* ... */

                    'edit' =&gt; [
                        'type' =&gt; Segment::class,
                        'options' =&gt; [
                            'route'    =&gt; '/edit/:id',
                            'defaults' =&gt; [
                                'controller' =&gt; Controller\WriteController::class,
                                'action'     =&gt; 'edit',
                            ],
                            'constraints' =&gt; [
                                'id' =&gt; '[1-9]\d*',
                            ],
                        ],
                    ],
                ],
            ],
        ],
    ],
    'view_manager'    =&gt; [ /* ... */ ],
];</code></pre>

<h2 id="creating-the-edit-template">Creating the edit template</h2>
<p>Rendering the form remains essentially the same between the <code>add</code> and <code>edit</code>
templates; the only difference between them is the form action. As such, we will
create a new <em>partial</em> script for the form, update the <code>add</code> template to use it,
and create a new <code>edit</code> template.</p>
<p>Create a new file, <code>module/Blog/view/blog/write/form.phtml</code>, with the following
contents:</p>
<pre class="codehilite"><code class="language-php linenums">&lt;?php
$form = $this-&gt;form;
$fieldset = $form-&gt;get('post');

$title = $fieldset-&gt;get('title');
$title-&gt;setAttribute('class', 'form-control');
$title-&gt;setAttribute('placeholder', 'Post title');

$text = $fieldset-&gt;get('text');
$text-&gt;setAttribute('class', 'form-control');
$text-&gt;setAttribute('placeholder', 'Post content');

$submit = $form-&gt;get('submit');
$submit-&gt;setValue($this-&gt;submitLabel);
$submit-&gt;setAttribute('class', 'btn btn-primary');

$form-&gt;prepare();

echo $this-&gt;form()-&gt;openTag($form);
?&gt;

&lt;fieldset&gt;
&lt;div class=&quot;form-group&quot;&gt;
    &lt;?= $this-&gt;formLabel($title) ?&gt;
    &lt;?= $this-&gt;formElement($title) ?&gt;
    &lt;?= $this-&gt;formElementErrors()-&gt;render($title, ['class' =&gt; 'help-block']) ?&gt;
&lt;/div&gt;

&lt;div class=&quot;form-group&quot;&gt;
    &lt;?= $this-&gt;formLabel($text) ?&gt;
    &lt;?= $this-&gt;formElement($text) ?&gt;
    &lt;?= $this-&gt;formElementErrors()-&gt;render($text, ['class' =&gt; 'help-block']) ?&gt;
&lt;/div&gt;
&lt;/fieldset&gt;

&lt;?php
echo $this-&gt;formSubmit($submit);
echo $this-&gt;formHidden($fieldset-&gt;get('id'));
echo $this-&gt;form()-&gt;closeTag();</code></pre>

<p>Now, update the <code>add</code> template, <code>module/Blog/view/write/add.phtml</code> to read as
follows:</p>
<pre class="codehilite"><code class="language-php linenums">&lt;h1&gt;Add a blog post&lt;/h1&gt;

&lt;?php
$form = $this-&gt;form;
$form-&gt;setAttribute('action', $this-&gt;url());
echo $this-&gt;partial('blog/write/form', [
    'form' =&gt; $form,
    'submitLabel' =&gt; 'Insert new post',
]);</code></pre>

<p>The above retrieves the form, sets the form action, provides a
context-appropriate label for the submit button, and renders it with our new
partial view script.</p>
<p>Next in line is the creation of the new template, <code>blog/write/edit</code>:</p>
<pre class="codehilite"><code class="language-php linenums">&lt;h1&gt;Edit blog post&lt;/h1&gt;

&lt;?php
$form = $this-&gt;form;
$form-&gt;setAttribute('action', $this-&gt;url('blog/edit', [], true));
echo $this-&gt;partial('blog/write/form', [
    'form' =&gt; $form,
    'submitLabel' =&gt; 'Update post',
]);</code></pre>

<p>The three differences between the <code>add</code> and <code>edit</code> templates are:</p>
<ul>
<li>The heading at the top of the page.</li>
<li>The URI used for the form action.</li>
<li>The label used for the submit button.</li>
</ul>
<p>Because the URI requires the identifier, we need to ensure the identifier is
passed. The way we've done this in the controllers is to pass the identifier as
a parameter: <code>$this-&gt;url('blog/edit/', ['id' =&gt; $id])</code>. This would require that
we pass the original <code>Post</code> instance or the identifier we pull from it to the
view, however. zend-router allows another option, however: you can tell it to
re-use currently matched parameters.  This is done by setting the last parameter
of the view-helper to <code>true</code>: <code>$this-&gt;url('blog/edit', [], true)</code>.</p>
<p>If you try and update the post, it'll be successful, but you'll notice that no
edits were saved! Why? Because we have not yet implemented the functionality in
our command class. Let's do that now.</p>
<p>Edit the file <code>module/Blog/src/Model/ZendDbSqlCommand.php</code>, and update the
<code>updatePost()</code> method to read as follows:</p>
<pre class="codehilite"><code class="language-php linenums">public function updatePost(Post $post)
{
    if (! $post-&gt;getId()) {
        throw new RuntimeException('Cannot update post; missing identifier');
    }

    $update = new Update('posts');
    $update-&gt;set([
            'title' =&gt; $post-&gt;getTitle(),
            'text' =&gt; $post-&gt;getText(),
    ]);
    $update-&gt;where(['id = ?' =&gt; $post-&gt;getId()]);

    $sql = new Sql($this-&gt;db);
    $statement = $sql-&gt;prepareStatementForSqlObject($update);
    $result = $statement-&gt;execute();

    if (! $result instanceof ResultInterface) {
        throw new RuntimeException(
            'Database error occurred during blog post update operation'
        );
    }

    return $post;
}</code></pre>

<p>This looks very similar to the <code>insertPost()</code> implementation we did earlier. The
primary difference is the usage of the <code>Update</code> class; instead of calling a
<code>values()</code> method on it, we call:</p>
<ul>
<li><code>set()</code>, to provide the values we are updating.</li>
<li><code>where()</code>, to provide criteria to determine which records (record singular, in
  our case) are updated.</li>
</ul>
<p>Additionally, we test for the presence of an identifier before performing the
operation, and, because we already have one, and the <code>Post</code> submitted to us
contains all the edits we submitted to the database, we return it verbatim on
success.</p>
<h2 id="implementing-the-delete-functionality">Implementing the delete functionality</h2>
<p>Last but not least, it's time to delete some data. We start this process by
implementing the <code>deletePost()</code> method in our <code>ZendDbSqlCommand</code> class:</p>
<pre class="codehilite"><code class="language-php linenums">// In module/Blog/src/Model/ZendDbSqlCommand.php:

public function deletePost(Post $post)
{
    if (! $post-&gt;getId()) {
        throw new RuntimeException('Cannot update post; missing identifier');
    }

    $delete = new Delete('posts');
    $delete-&gt;where(['id = ?' =&gt; $post-&gt;getId()]);

    $sql = new Sql($this-&gt;db);
    $statement = $sql-&gt;prepareStatementForSqlObject($delete);
    $result = $statement-&gt;execute();

    if (! $result instanceof ResultInterface) {
        return false;
    }

    return true;
}</code></pre>

<p>The above uses <code>Zend\Db\Sql\Delete</code> to create the SQL necessary to delete the
post with the given identifier, which we then execute.</p>
<p>Next, let's create a new controller, <code>Blog\Controller\DeleteController</code>, in a
new file <code>module/Blog/src/Controller/DeleteController.php</code>, with the following
contents:</p>
<pre class="codehilite"><code class="language-php linenums">&lt;?php
namespace Blog\Controller;

use Blog\Model\Post;
use Blog\Model\PostCommandInterface;
use Blog\Model\PostRepositoryInterface;
use InvalidArgumentException;
use Zend\Mvc\Controller\AbstractActionController;
use Zend\View\Model\ViewModel;

class DeleteController extends AbstractActionController
{
    /**
     * @var PostCommandInterface
     */
    private $command;

    /**
     * @var PostRepositoryInterface
     */
    private $repository;

    /**
     * @param PostCommandInterface $command
     * @param PostRepositoryInterface $repository
     */
    public function __construct(
        PostCommandInterface $command,
        PostRepositoryInterface $repository
    ) {
        $this-&gt;command = $command;
        $this-&gt;repository = $repository;
    }

    public function deleteAction()
    {
        $id = $this-&gt;params()-&gt;fromRoute('id');
        if (! $id) {
            return $this-&gt;redirect()-&gt;toRoute('blog');
        }

        try {
            $post = $this-&gt;repository-&gt;findPost($id);
        } catch (InvalidArgumentException $ex) {
            return $this-&gt;redirect()-&gt;toRoute('blog');
        }

        $request = $this-&gt;getRequest();
        if (! $request-&gt;isPost()) {
            return new ViewModel(['post' =&gt; $post]);
        }

        if ($id != $request-&gt;getPost('id')
            || 'Delete' !== $request-&gt;getPost('confirm', 'no')
        ) {
            return $this-&gt;redirect()-&gt;toRoute('blog');
        }

        $post = $this-&gt;command-&gt;deletePost($post);
        return $this-&gt;redirect()-&gt;toRoute('blog');
    }
}</code></pre>

<p>Like the <code>WriteController</code>, it composes both our <code>PostRepositoryInterface</code> and
<code>PostCommandInterface</code>. The former is used to ensure we are referencing a valid
post instance, and the latter to perform the actual deletion.</p>
<p>When a user requests the page via the <code>GET</code> method, we will display a page
containing details of the post, and a confirmation form. When submitted, we'll
check to make sure they confirmed the deletion before issuing our delete
command. If any conditions fail, or on a successful deletion, we redirect to our
blog listing page.</p>
<p>Like the other controllers, we now need a factory. Create the file
<code>module/Blog/src/Factory/DeleteControllerFactory.php</code> with the following
contents:</p>
<pre class="codehilite"><code class="language-php linenums">&lt;?php
namespace Blog\Factory;

use Blog\Controller\DeleteController;
use Blog\Model\PostCommandInterface;
use Blog\Model\PostRepositoryInterface;
use Interop\Container\ContainerInterface;
use Zend\ServiceManager\Factory\FactoryInterface;

class DeleteControllerFactory implements FactoryInterface
{
    /**
     * @param ContainerInterface $container
     * @param string $requestedName
     * @param null|array $options
     * @return DeleteController
     */
    public function __invoke(ContainerInterface $container, $requestedName, array $options = null)
    {
        return new DeleteController(
            $container-&gt;get(PostCommandInterface::class),
            $container-&gt;get(PostRepositoryInterface::class)
        );
    }
}</code></pre>

<p>We'll now wire this into the application, mapping the controller to its factory,
and providing a new route. Open the file <code>module/Blog/config/module.config.php</code>
and make the following edits.</p>
<p>First, map the controller to its factory:</p>
<pre class="codehilite"><code class="language-php linenums">'controllers' =&gt; [
    'factories' =&gt; [
        Controller\ListController::class =&gt; Factory\ListControllerFactory::class,
        Controller\WriteController::class =&gt; Factory\WriteControllerFactory::class,
        // Add the following line:
        Controller\DeleteController::class =&gt; Factory\DeleteControllerFactory::class,
    ],
],</code></pre>

<p>Now add another child route to our "blog" route:</p>
<pre class="codehilite"><code class="language-php linenums">'router' =&gt; [
    'routes' =&gt; [
        'blog' =&gt; [
            /* ... */

            'child_routes' =&gt; [
                /* ... */

                'delete' =&gt; [
                    'type' =&gt; Segment::class,
                    'options' =&gt; [
                        'route' =&gt; '/delete/:id',
                        'defaults' =&gt; [
                            'controller' =&gt; Controller\DeleteController::class,
                            'action'     =&gt; 'delete',
                        ],
                        'constraints' =&gt; [
                            'id' =&gt; '[1-9]\d*',
                        ],
                    ],
                ],
            ],
        ],
    ],
],</code></pre>

<p>Finally, we'll create a new view script,
<code>module/Blog/view/blog/delete/delete.phtml</code>, with the following contents:</p>
<pre class="codehilite"><code class="language-php linenums">&lt;h1&gt;Delete post&lt;/h1&gt;

&lt;p&gt;Are you sure you want to delete the following post?&lt;/p&gt;

&lt;ul class=&quot;list-group&quot;&gt;
    &lt;li class=&quot;list-group-item&quot;&gt;&lt;?= $this-&gt;escapeHtml($this-&gt;post-&gt;getTitle()) ?&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;form action=&quot;&lt;?php $this-&gt;url('blog/delete', [], true) ?&gt;&quot; method=&quot;post&quot;&gt;
    &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value=&quot;&lt;?= $this-&gt;escapeHtmlAttr($this-&gt;post-&gt;getId()) ?&gt;&quot; /&gt;
    &lt;input class=&quot;btn btn-default&quot; type=&quot;submit&quot; name=&quot;confirm&quot; value=&quot;Cancel&quot; /&gt;
    &lt;input class=&quot;btn btn-danger&quot; type=&quot;submit&quot; name=&quot;confirm&quot; value=&quot;Delete&quot; /&gt;
&lt;/form&gt;</code></pre>

<p>This time around, we're not using zend-form; as it consists of just a hidden
element and cancel/confirm buttons, there's no need to provide an OOP model for it.</p>
<p>From here, you can now visit one of the existing blog posts, e.g.,
<code>http://localhost:8080/blog/delete/1</code> to see the form. If you choose <code>Cancel</code>,
you should be taken back to the list; if you choose <code>Delete</code>, it should delete
the post and then take you back to the list, and you should see the post is no
longer present.</p>
<h2 id="making-the-list-more-useful">Making the list more useful</h2>
<p>Our blog post list currently lists everything about all of our blog posts;
additionally, it doesn't link to them, which means we have to manually update
the URL in our browser in order to test functionality. Let's update the list
view to be more useful; we'll:</p>
<ul>
<li>List just the title of each blog post;</li>
<li>linking the title to the post display;</li>
<li>and providing links for editing and deleting the post.</li>
<li>Add a button to allow users to add a new post.</li>
</ul>
<p>In a real-world application, we'd probably use some sort of access controls to
determine if the edit and delete links will be displayed; we'll leave that for
another tutorial, however.</p>
<p>Open your <code>module/Blog/view/blog/list/index.phtml</code> file, and update it to read
as follows:</p>
<pre class="codehilite"><code class="language-php linenums">&lt;h1&gt;Blog Posts&lt;/h1&gt;

&lt;div class=&quot;list-group&quot;&gt;
&lt;?php foreach ($this-&gt;posts as $post): ?&gt;
  &lt;div class=&quot;list-group-item&quot;&gt;
    &lt;h4 class=&quot;list-group-item-heading&quot;&gt;
      &lt;a href=&quot;&lt;?= $this-&gt;url('blog/detail', ['id' =&gt; $post-&gt;getId()]) ?&gt;&quot;&gt;
        &lt;?= $post-&gt;getTitle() ?&gt;
      &lt;/a&gt;
    &lt;/h4&gt;

    &lt;div class=&quot;btn-group&quot; role=&quot;group&quot; aria-label=&quot;Post actions&quot;&gt;
      &lt;a class=&quot;btn btn-xs btn-default&quot; href=&quot;&lt;?= $this-&gt;url('blog/edit', ['id' =&gt; $post-&gt;getId()]) ?&gt;&quot;&gt;Edit&lt;/a&gt;
      &lt;a class=&quot;btn btn-xs btn-danger&quot; href=&quot;&lt;?= $this-&gt;url('blog/delete', ['id' =&gt; $post-&gt;getId()]) ?&gt;&quot;&gt;Delete&lt;/a&gt;
    &lt;/div&gt;
  &lt;/div&gt;    
&lt;?php endforeach ?&gt;
&lt;/div&gt;

&lt;div class=&quot;btn-group&quot; role=&quot;group&quot; aria-label=&quot;Post actions&quot;&gt;
  &lt;a class=&quot;btn btn-primary&quot; href=&quot;&lt;?= $this-&gt;url('blog/add') ?&gt;&quot;&gt;Write new post&lt;/a&gt;
&lt;/div&gt;</code></pre>

<p>At this point, we have a far more functional blog, as we can move around between
pages using links and buttons.</p>
<h2 id="summary">Summary</h2>
<p>In this chapter we've learned how data binding within the zend-form component
works, and used it to provide functionality for our update routine. We also
learned how this allows us to de-couple our controllers from the details of how
a form is structured, helping us keep implementation details out of our
controller.</p>
<p>We also demonstrated the use of view partials, which allow us to split out
duplication in our views and re-use them. In particular, we did this with our
form, to prevent needlessly duplicating the form markup.</p>
<p>Finally, we looked at two more aspects of the <code>Zend\Db\Sql</code> subcomponent, and
learned how to <code>Update</code> and <code>Delete</code> operations.</p>
<p>In the next chapter we'll summarize everything we've done. We'll talk about the
design patterns we've used, and we'll cover several questions that likely arose
during the course of this tutorial.</p>

<hr />


<nav>
  <ul class="pager hidden-print">
    <li class="previous">
      <a rel="prev" href="../zend-form-zend-form-fieldset/"><i class="fa fa-arrow-left"></i> Previous</a>
    </li>
    <li class="next">
      <a rel="next" href="../review/">Next <i class="fa fa-arrow-right"></i></a>
    </li>
  </ul>
</nav>
</div>
        
    </div>
    <!-- content:end -->

    <div id="footerwrap">
    <div class="container">
        <div class="row site-map">
            <div class="col-lg-3">
              <p>
                <strong>Zend Framework</strong><br />
                <a href="http://framework.zend.com/">framework.zend.com</a><br />
                <a href="https://docs.zendframework.com">docs.zendframework.com</a><br />
                <a href="https://packages.zendframework.com">packages.zendframework.com</a><br />
                <a href="https://apigility.org">apigility.org</a><br />
              </p>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12 centered">
                <a class="back-to-top" href="#page-top"><i class="fa fa-chevron-circle-up fa-4" aria-hidden="true"></i></a>
            </div>
        </div>

        <div class="spacing"></div>

        <div class="row">
            <div class="col-lg-8">
                <h4>Copyright</h4>
                <div class="hline-w"></div>

                <p>&copy; 2006-2016 by <a href="http://www.zend.com">Zend</a>, a <a href="http://www.roguewave.com/">Rogue Wave Company</a>.</p>
            </div>

            <div class="col-lg-4">
                <h4>Contacts</h4>
                <div class="hline-w"></div>
                <p>
                    <a href="irc://irc.freenode.net/zftalk" class="btn-social btn-outline" alt="IRC" title="IRC"><i class="fa fa-comment"></i></a>
                    <a href="https://github.com/zendframework" class="btn-social btn-outline" alt="Github" title="Github"><i class="fa fa-github"></i></a>
                    <a href="https://twitter.com/zfdevteam" class="btn-social btn-outline" alt="Twitter" title="Twitter"><i class="fa fa-twitter"></i></a>
                </p>
            </div>
        </div>
    </div>
</div>


    <script src="../../js/jquery-1.10.2.min.js"></script>
    <script src="../../js/bootstrap-3.0.3.min.js"></script>
    <script src="../../js/prism-zf.js"></script>

    <script>var base_url = '../..';</script>
    <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
    <script src="../../js/base.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    <div class="zf-components">
  <div class="zf-components-grid">
    <div class="zf-logo">
      <a href="http://framework.zend.com" data-toggle="tooltip" data-placement="bottom" title="Go to the ZF homepage"><img src="../../img/zf-logo-mark.svg" alt="Zend Framework" width="250" /></a>
    </div>

    <div class="component-list"></div>

    <p class="zf-components-rollup"><a href="#">Hide list</a></p>
  </div>
</div>

    <script>
  // Prepare the component list dropdown for display
  $(function () {
    var components = $(".zf-components"),
        componentList = components.find(".component-list"),
        sidebar = $(".bs-sidebar.affix"),
        sidebarInitialPos = sidebar.css("position"),
        hidden,
        componentToggle = $(".component-toggle"),
        navbar = $(".navbar-fixed-top"),
        rollUpLink = $(".zf-components-rollup a");

    // Initial setup on document load
    components.insertBefore(navbar);
    $(".zf-logo a").tooltip();
    componentToggle.tooltip();
    rollUpLink.attr({ href: "#", alt: "Hide component list" });

    // Cast initial sidebar position value
    if (undefined === sidebarInitialPos) {
      sidebarInitialPos = "fixed";
    }

    // Setup onclick events to toggle list
    componentToggle.click(toggleComponentList);
    rollUpLink.click(toggleComponentList);

    // Toggle the component list display
    function toggleComponentList(event) {
      event.preventDefault();

      if (hidden === undefined) {
        // Not loaded yet; load and display.
        loadComponentList();
        return;
      }

      if (hidden) {
        // Hidden; display.
        showComponentList();
        return;
      }

      // Currently visible; hide
      hideComponentList();
    }

    // Show the component list
    function showComponentList() {
      navbar.css({position: "relative"});
      sidebar.css({position: "relative"});
      components
        .css({"margin-top": "-" + components.outerHeight() + "px"})
        .show()
        .animate({"margin-top": 0}, {
          complete: function () {
            componentToggle
              .data("placement", "top")
              .attr("data-original-title", "Hide component list");
            hidden = false;
          },
          queue: false
        });
    }

    // Hide the component list
    function hideComponentList() {
      components.animate({"margin-top": "-" + components.outerHeight() + "px"}, {
        complete: function () {
          navbar.css({position: "fixed"});
          sidebar.css({position: sidebarInitialPos});
          componentToggle
            .data("placement", "bottom")
            .attr("data-original-title", "Show component list");
          components.hide();
          hidden = true;
        },
        queue: false
      });
      sidebar.animate({ top: sidebarInitialTop + "px" }, { queue: false});
    }

    // Inject a component into the componet list DOM.
    function injectComponent(index, component) {
      componentList.append('<div class="component"><h4><a href="' + component.url + '">' + component.name + '</a></h4><p>' + component.description + '</p></div>');
    }

    // Parse the component list, build the DOM, and display it.
    function parseComponentList(components) {
      $.each(components, injectComponent);
      showComponentList();
    }

    // Fetch the component list and display it.
    function loadComponentList () {
      $.ajax({
        url: "//docs.zendframework.com/zf-mkdoc-theme/scripts/zf-component-list.json",
        dataType: "text json",
        success: parseComponentList,
        error: function (e) {
          console.log("Error occurred with XHR call", e);
        }
      });
    }
  });
</script>
    </body>

</html>
