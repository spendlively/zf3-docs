<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <link rel="shortcut icon" href="../img/favicon.ico">

    <title>File Uploads - zend-form</title>

    <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/2.018/css/hack.min.css">
    <link href="//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Libre+Baskerville:400,400italic,700&subset=latin,latin-ext" rel="stylesheet" type="text/css">
    <link href="../css/base.css" rel="stylesheet">
    <link href="../css/zf-web.css" rel="stylesheet">
    <link href="../css/zf.css" rel="stylesheet">
    <link href="../css/prism-zf.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <span class="navbar-brand">
              <a class="logo-link" href="http://framework.zend.com" data-toggle="tooltip" data-placement="bottom" title="Zend Framework"><img src="../img/zf-logo-mark.svg" height="28" alt="Zend Framework" /></a>
              <a href="..">zend-form</a>
            </span>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="..">Home</a>
                    </li>
                
                
                
                    <li >
                        <a href="../intro/">Intro</a>
                    </li>
                
                
                
                    <li >
                        <a href="../quick-start/">Quick Start</a>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reference <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Elements</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../element/intro/">Intro</a>
</li>

        
            
<li >
    <a href="../element/element/">Element</a>
</li>

        
            
<li >
    <a href="../element/button/">button</a>
</li>

        
            
<li >
    <a href="../element/captcha/">CAPTCHA</a>
</li>

        
            
<li >
    <a href="../element/checkbox/">checkbox</a>
</li>

        
            
<li >
    <a href="../element/collection/">Collection</a>
</li>

        
            
<li >
    <a href="../element/color/">color</a>
</li>

        
            
<li >
    <a href="../element/csrf/">CSRF</a>
</li>

        
            
<li >
    <a href="../element/date/">date</a>
</li>

        
            
<li >
    <a href="../element/date-time/">datetime</a>
</li>

        
            
<li >
    <a href="../element/date-time-local/">datetime-local</a>
</li>

        
            
<li >
    <a href="../element/email/">email</a>
</li>

        
            
<li >
    <a href="../element/file/">file</a>
</li>

        
            
<li >
    <a href="../element/hidden/">hidden</a>
</li>

        
            
<li >
    <a href="../element/image/">image</a>
</li>

        
            
<li >
    <a href="../element/month/">month</a>
</li>

        
            
<li >
    <a href="../element/month-select/">MonthSelect</a>
</li>

        
            
<li >
    <a href="../element/multi-checkbox/">MultiCheckbox</a>
</li>

        
            
<li >
    <a href="../element/number/">number</a>
</li>

        
            
<li >
    <a href="../element/password/">password</a>
</li>

        
            
<li >
    <a href="../element/radio/">radio</a>
</li>

        
            
<li >
    <a href="../element/range/">range</a>
</li>

        
            
<li >
    <a href="../element/search/">search</a>
</li>

        
            
<li >
    <a href="../element/select/">select</a>
</li>

        
            
<li >
    <a href="../element/submit/">submit</a>
</li>

        
            
<li >
    <a href="../element/tel/">tel</a>
</li>

        
            
<li >
    <a href="../element/text/">text</a>
</li>

        
            
<li >
    <a href="../element/textarea/">textarea</a>
</li>

        
            
<li >
    <a href="../element/time/">time</a>
</li>

        
            
<li >
    <a href="../element/url/">url</a>
</li>

        
            
<li >
    <a href="../element/week/">week</a>
</li>

        
    </ul>
  </li>

                        
                            
<li >
    <a href="../collections/">Collections</a>
</li>

                        
                            
<li class="active">
    <a href="./">File Uploads</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">View Helpers</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../helper/intro/">Intro</a>
</li>

        
            
<li >
    <a href="../helper/abstract-helper/">AbstractHelper</a>
</li>

        
            
<li >
    <a href="../helper/form-input/">formInput</a>
</li>

        
            
<li >
    <a href="../helper/form-element/">formElement</a>
</li>

        
            
<li >
    <a href="../helper/form-element-errors/">formElementErrors</a>
</li>

        
            
<li >
    <a href="../helper/form-label/">formLabel</a>
</li>

        
            
<li >
    <a href="../helper/form-row/">formRow</a>
</li>

        
            
<li >
    <a href="../helper/form-collection/">formCollection</a>
</li>

        
            
<li >
    <a href="../helper/form/">form</a>
</li>

        
            
<li >
    <a href="../helper/form-button/">formButton</a>
</li>

        
            
<li >
    <a href="../helper/form-captcha/">formCaptcha</a>
</li>

        
            
<li >
    <a href="../helper/form-checkbox/">formCheckbox</a>
</li>

        
            
<li >
    <a href="../helper/form-color/">formColor</a>
</li>

        
            
<li >
    <a href="../helper/form-date/">formDate</a>
</li>

        
            
<li >
    <a href="../helper/form-date-time/">formDateTime</a>
</li>

        
            
<li >
    <a href="../helper/form-date-time-local/">formDateTimeLocal</a>
</li>

        
            
<li >
    <a href="../helper/form-email/">formEmail</a>
</li>

        
            
<li >
    <a href="../helper/form-file/">formFile</a>
</li>

        
            
<li >
    <a href="../helper/form-hidden/">formHidden</a>
</li>

        
            
<li >
    <a href="../helper/form-image/">formImage</a>
</li>

        
            
<li >
    <a href="../helper/form-month/">formMonth</a>
</li>

        
            
<li >
    <a href="../helper/form-month-select/">formMonthSelect</a>
</li>

        
            
<li >
    <a href="../helper/form-multicheckbox/">formMultiCheckbox</a>
</li>

        
            
<li >
    <a href="../helper/form-number/">formNumber</a>
</li>

        
            
<li >
    <a href="../helper/form-password/">formPassword</a>
</li>

        
            
<li >
    <a href="../helper/form-radio/">formRadio</a>
</li>

        
            
<li >
    <a href="../helper/form-range/">formRange</a>
</li>

        
            
<li >
    <a href="../helper/form-reset/">formReset</a>
</li>

        
            
<li >
    <a href="../helper/form-search/">formSearch</a>
</li>

        
            
<li >
    <a href="../helper/form-select/">formSelect</a>
</li>

        
            
<li >
    <a href="../helper/form-submit/">formSubmit</a>
</li>

        
            
<li >
    <a href="../helper/form-tel/">formTel</a>
</li>

        
            
<li >
    <a href="../helper/form-text/">formText</a>
</li>

        
            
<li >
    <a href="../helper/form-textarea/">formTextarea</a>
</li>

        
            
<li >
    <a href="../helper/form-time/">formTime</a>
</li>

        
            
<li >
    <a href="../helper/form-url/">formUrl</a>
</li>

        
            
<li >
    <a href="../helper/form-week/">formWeek</a>
</li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Upload Progress</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../helper/upload-progress-helpers/">Intro</a>
</li>

        
            
<li >
    <a href="../helper/form-file-apc-progress/">formFileApcProgress</a>
</li>

        
            
<li >
    <a href="../helper/form-file-session-progress/">formFileSessionProgress</a>
</li>

        
            
<li >
    <a href="../helper/form-file-upload-progress/">formFileUploadProgress</a>
</li>

        
    </ul>
  </li>

        
    </ul>
  </li>

                        
                            
<li >
    <a href="../advanced/">Advanced</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" class="component-toggle" data-toggle="tooltip" data-placement="bottom" title="Show component list">
                        <i class="fa fa-book"></i> Components
                    </a>
                </li>

                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li>
                        <a href="https://github.com/zendframework/zend-form">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

    <!-- content:begin -->
    <div id="page-top" class="container docs">
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#file-uploads">File Uploads</a></li>
        
            <li><a href="#limited-to-post-uploads">Limited to POST uploads</a></li>
        
            <li><a href="#basic-example">Basic Example</a></li>
        
            <li><a href="#file-post-redirect-get-plugin">File Post-Redirect-Get Plugin</a></li>
        
            <li><a href="#html5-multi-file-uploads">HTML5 Multi-File Uploads</a></li>
        
            <li><a href="#upload-progress">Upload Progress</a></li>
        
            <li><a href="#additional-info">Additional Info</a></li>
        
    
    </ul>

    
    <ul class="pager hidden-print">
      <li class="previous">
        <a rel="prev" href="../collections/"><i class="fa fa-arrow-left"></i> Previous</a>
      </li>
      <li class="next">
        <a rel="next" href="../helper/intro/">Next <i class="fa fa-arrow-right"></i></a>
      </li>
    </ul>
    
</div></div>
        <div class="col-md-9" role="main">

<ol class="breadcrumb" role="navigation" aria-label="breadcrumbs navigation">
  <li><a href="..">zend-form</a> &raquo;</li>
  
    
      
        <li>Reference &raquo;</li>
      
    
  
  <li class="active">File Uploads</li>
</ol>

<h1 id="file-uploads">File Uploads</h1>
<p>zend-form provides support for file uploading by using features from each of
<a href="https://github.com/zendframework/zend-inputfilter">zend-inputfilter</a>,
<a href="https://github.com/zendframework/zend-validator">zend-validator</a>,
<a href="https://docs.zendframework.com/zend-filter">zend-filter</a>, and
<a href="https://github.com/zendframework/zend-progressbar">zend-progressbar</a>. These
reusable framework components provide a convenient and secure way for handling
file uploads in your projects.</p>
<blockquote>
<h3 id="limited-to-post-uploads">Limited to POST uploads</h3>
<p>The file upload features described here are specifically for forms using the
<code>POST</code> method.  zend-form does not currently provide specific support for
handling uploads via the <code>PUT</code> method, but it is possible with vanilla PHP.
See the <a href="http://php.net/features.file-upload.put-method">PUT Method Support</a>
in the PHP documentation for more information.</p>
</blockquote>
<h2 id="basic-example">Basic Example</h2>
<p>Handling file uploads is <em>essentially</em> the same as how you would use <code>Zend\Form</code>
for form processing, but with some slight caveats that will be described below.</p>
<p>In this example we will:</p>
<ul>
<li>Define a <strong>Form</strong> for backend validation and filtering.</li>
<li>Create a <strong>view template</strong> with a <code>&lt;form&gt;</code> containing a file input.</li>
<li>Process the form within a <strong>Controller action</strong>.</li>
</ul>
<h3 id="the-form-and-inputfilter">The Form and InputFilter</h3>
<p>Here we define a <code>Zend\Form\Element\File</code> input in a <code>Form</code> extension named
<code>UploadForm</code>.</p>
<pre class="codehilite"><code class="language-php linenums">use Zend\Form\Element;
use Zend\Form\Form;

class UploadForm extends Form
{
    public function __construct($name = null, $options = [])
    {
        parent::__construct($name, $options);
        $this-&gt;addElements();
    }

    public function addElements()
    {
        // File Input
        $file = new Element\File('image-file');
        $file-&gt;setLabel('Avatar Image Upload');
        $file-&gt;setAttribute('id', 'image-file');

        $this-&gt;add($file);
    }
}</code></pre>

<p>The <code>File</code> element provides several automated features:</p>
<ul>
<li>The form's <code>enctype</code> will automatically be set to <code>multipart/form-data</code> when
  the form's <code>prepare()</code> method is called.</li>
<li>The file element's default input specification will create the correct <code>Input</code>
  type: <a href="https://docs.zendframework.com/zend-inputfilter/file-input/"><code>Zend\InputFilter\FileInput</code></a>.</li>
<li>The <code>FileInput</code> will automatically prepend an <a href="https://docs.zendframework.com/zend-validator/validators/file/upload-file/">UploadFile validator</a>
  to securely validate that the file is actually an uploaded file, and to report
  any upload errors to the user.</li>
</ul>
<h3 id="the-view-template">The View Template</h3>
<p>In the view template, we render the <code>&lt;form&gt;</code>, a file input (with label and
errors), and a submit button.</p>
<pre class="codehilite"><code class="language-php linenums">&lt;!-- File: upload-form.phtml --&gt;
&lt;?php
    $form-&gt;prepare(); // The correct enctype is set here
    $fileElement = $form-&gt;get('image-file');
    echo $this-&gt;form()-&gt;openTag($form);
?&gt;

    &lt;div class=&quot;form-element&quot;&gt;
        &lt;?= $this-&gt;formLabel($fileElement) ?&gt;
        &lt;?= $this-&gt;formFile($fileElement) ?&gt;
        &lt;?= $this-&gt;formElementErrors($fileElement) ?&gt;
    &lt;/div&gt;

    &lt;button&gt;Submit&lt;/button&gt;

&lt;?= $this-&gt;form()-&gt;closeTag() ?&gt;</code></pre>

<p>When rendered, the HTML should look similar to:</p>
<pre class="codehilite"><code class="language-html linenums">&lt;form name=&quot;upload-form&quot; id=&quot;upload-form&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;
    &lt;div class=&quot;form-element&quot;&gt;
        &lt;label for=&quot;image-file&quot;&gt;Avatar Image Upload&lt;/label&gt;
        &lt;input type=&quot;file&quot; name=&quot;image-file&quot; id=&quot;image-file&quot;&gt;
    &lt;/div&gt;

    &lt;button&gt;Submit&lt;/button&gt;
&lt;/form&gt;</code></pre>

<h3 id="the-controller-action">The Controller Action</h3>
<p>For the final step, we will instantiate the <code>UploadForm</code> and process any
postbacks in a controller action.</p>
<p>The form processing in the controller action will be similar to normal forms,
<em>except</em> that you <strong>must</strong> merge the <code>$_FILES</code> information in the request with
the other post data.</p>
<pre class="codehilite"><code class="language-php linenums">public function uploadFormAction()
{
    $form = new UploadForm('upload-form');

    $request = $this-&gt;getRequest(); 
    if ($request-&gt;isPost()) {
        // Make certain to merge the $_FILES info!
        $post = array_merge_recursive(
            $request-&gt;getPost()-&gt;toArray(),
            $request-&gt;getFiles()-&gt;toArray()
        );

        $form-&gt;setData($post);
        if ($form-&gt;isValid()) {
            $data = $form-&gt;getData();

            // Form is valid, save the form!
            return $this-&gt;redirect()-&gt;toRoute('upload-form/success');
        }
    }

    return ['form' =&gt; $form];
}</code></pre>

<p>Upon a successful file upload, <code>$form-&gt;getData()</code> would return:</p>
<pre class="codehilite"><code class="language-php linenums">array(1) {
    [&quot;image-file&quot;] =&gt; array(5) {
        [&quot;name&quot;]     =&gt; string(11) &quot;myimage.png&quot;
        [&quot;type&quot;]     =&gt; string(9)  &quot;image/png&quot;
        [&quot;tmp_name&quot;] =&gt; string(22) &quot;/private/tmp/phpgRXd58&quot;
        [&quot;error&quot;]    =&gt; int(0)
        [&quot;size&quot;]     =&gt; int(14908679)
    }
}</code></pre>

<blockquote>
<h3 id="using-nested-array-notation-for-uploads">Using nested array notation for uploads</h3>
<p>It is suggested that you always use the <code>Zend\Http\PhpEnvironment\Request</code>
object to retrieve and merge the <code>$_FILES</code> information with the form, instead
of using <code>$_FILES</code> directly,  due to how the file information is
mapped in the <code>$_FILES</code> array:</p>
<pre class="codehilite"><code class="language-php linenums">// A $_FILES array with single input and multiple files:
array(1) {
    [&quot;image-file&quot;]=array(2) {
        [&quot;name&quot;]=array(2) {
            [0]=string(9)&quot;file0.txt&quot;
            [1]=string(9)&quot;file1.txt&quot;
        }
        [&quot;type&quot;]=array(2) {
            [0]=string(10)&quot;text/plain&quot;
            [1]=string(10)&quot;text/html&quot;
        }
    }
}

// How Zend\Http\PhpEnvironment\Request remaps the $_FILES array:
array(1) {
    [&quot;image-file&quot;]=array(2) {
        [0]=array(2) {
            [&quot;name&quot;]=string(9)&quot;file0.txt&quot;
            [&quot;type&quot;]=string(10)&quot;text/plain&quot;
        },
        [1]=array(2) {
            [&quot;name&quot;]=string(9)&quot;file1.txt&quot;
            [&quot;type&quot;]=string(10)&quot;text/html&quot;
        }
    }
}</code></pre>

<p><a href="https://docs.zendframework.com/zend-inputfilter/file-input/"><code>Zend\InputFilter\FileInput</code></a> expects the file data be in this
re-mapped array format.</p>
<p>Note: <a href="http://www.php-fig.org/psr/psr-7/">PSR-7</a> also remaps the <code>$_FILES</code>
array in this way.</p>
</blockquote>
<h2 id="file-post-redirect-get-plugin">File Post-Redirect-Get Plugin</h2>
<p>When using other standard form inputs (i.e. <code>text</code>, <code>checkbox</code>, <code>select</code>, etc.)
along with file inputs in a form, you can encounter a situation where some
inputs may become invalid and the user must re-select the file and re-upload.
PHP will delete uploaded files from the temporary directory at the end of the
request if it has not been moved away or renamed. Re-uploading a valid file each
time another form input is invalid is inefficient and annoying to users.</p>
<p>One strategy to get around this is to split the form into multiple forms. One
form for the file upload inputs and another for the other standard inputs.</p>
<p>When you cannot separate the forms, the <a href="https://docs.zendframework.com/zend-mvc-plugin-fileprg/">File Post-Redirect-Get
Plugin</a> can be used to
manage the file inputs and save off valid uploads until the entire form is
valid.</p>
<p>Changing our earlier example to use the <code>fileprg()</code> plugin will require two
changes.</p>
<h3 id="renameupload-filter">RenameUpload filter</h3>
<p>First, we need to add a <code>RenameUpload</code> filter to our form's file input, with
details on where the valid files should be stored:</p>
<pre class="codehilite"><code class="language-php linenums">use Zend\InputFilter;
use Zend\Form\Element;
use Zend\Form\Form;

class UploadForm extends Form
{
    public function __construct($name = null, $options = [])
    {
        parent::__construct($name, $options);
        $this-&gt;addElements();
        $this-&gt;addInputFilter();
    }

    public function addElements()
    {
        // File Input
        $file = new Element\File('image-file');
        $file-&gt;setLabel('Avatar Image Upload')
        $file-&gt;setAttribute('id', 'image-file');

        $this-&gt;add($file);
    }

    public function addInputFilter()
    {
        $inputFilter = new InputFilter\InputFilter();

        // File Input
        $fileInput = new InputFilter\FileInput('image-file');
        $fileInput-&gt;setRequired(true);
        $fileInput-&gt;getFilterChain()-&gt;attachByName(
            'filerenameupload',
            [
                'target'    =&gt; './data/tmpuploads/avatar.png',
                'randomize' =&gt; true,
            ]
        );
        $inputFilter-&gt;add($fileInput);

        $this-&gt;setInputFilter($inputFilter);
    }
}</code></pre>

<p>The <code>filerenameupload</code> options above would cause an uploaded file to be
renamed and moved to: <code>./data/tmpuploads/avatar_4b3403665fea6.png</code>.</p>
<p>See the <a href="http://zendframework.github.io/zend-filter/file/#renameupload">RenameUpload filter</a>
documentation for more information on its supported options.</p>
<h3 id="call-the-fileprg-plugin">Call the fileprg plugin</h3>
<p>Next, we need to update our controller action to use the <code>fileprg</code> plugin:</p>
<pre class="codehilite"><code class="language-php linenums">public function uploadFormAction()
{
    $form     = new UploadForm('upload-form');
    $tempFile = null;

    $prg = $this-&gt;fileprg($form);

    if ($prg instanceof \Zend\Http\PhpEnvironment\Response) {
        return $prg; // Return PRG redirect response
    }

    if (is_array($prg)) {
        if ($form-&gt;isValid()) {
            $data = $form-&gt;getData();

            // Form is valid, save the form!
            return $this-&gt;redirect()-&gt;toRoute('upload-form/success');
        }

        // Form not valid, but file uploads might be valid...
        // Get the temporary file information to show the user in the view
        $fileErrors = $form-&gt;get('image-file')-&gt;getMessages();

        if (empty($fileErrors)) {
            $tempFile = $form-&gt;get('image-file')-&gt;getValue();
        }
    }

    return [
        'form'     =&gt; $form,
        'tempFile' =&gt; $tempFile,
    ];
}</code></pre>

<p>Behind the scenes, the <code>FilePRG</code> plugin will:</p>
<ul>
<li>Run the Form's filters, namely the <code>RenameUpload</code> filter, to move the files
  out of temporary storage.</li>
<li>Store the valid POST data in the session across requests.</li>
<li>Change the <code>required</code> flag of any file inputs that had valid uploads to
  <code>false</code>. This is so that form re-submissions without uploads will not cause
  validation errors.</li>
</ul>
<blockquote>
<h3 id="user-notifications">User notifications</h3>
<p>In the case of a partially valid form, it is up to the developer whether to
notify the user that files have been uploaded or not. For example, you may
wish to hide the form input and/or display the file information. These things
would be implementation details in the view or in a custom view helper. Just
note that neither the <code>FilePRG</code> plugin nor the <code>formFile</code> view helper will do
any automatic notifications or view changes when files have been successfully
uploaded.</p>
</blockquote>
<h2 id="html5-multi-file-uploads">HTML5 Multi-File Uploads</h2>
<p>With HTML5, we are able to select multiple files from a single file input using
the <code>multiple</code> attribute. Not all <a href="http://caniuse.com/#feat=forms">browsers support multiple file
uploads</a>, but the file input will safely remain
a single file upload for those browsers that do not support the feature.</p>
<p>To enable multiple file uploads in zend-form, set the file element's
<code>multiple</code> attribute to true:</p>
<pre class="codehilite"><code class="language-php linenums">use Zend\InputFilter;
use Zend\Form\Element;
use Zend\Form\Form;

class UploadForm extends Form
{
    public function __construct($name = null, $options = [])
    {
        parent::__construct($name, $options);
        $this-&gt;addElements();
        $this-&gt;addInputFilter();
    }

    public function addElements()
    {
        // File Input
        $file = new Element\File('image-file');
        $file-&gt;setLabel('Avatar Image Upload');
        $file-&gt;setAttribute('id', 'image-file');
        $file-&gt;setAttribute('multiple', true);  // Marking as multiple

        $this-&gt;add($file);
    }

    public function addInputFilter()
    {
        $inputFilter = new InputFilter\InputFilter();

        // File Input
        $fileInput = new InputFilter\FileInput('image-file');
        $fileInput-&gt;setRequired(true);

        // Define validators and filters as if only one file was being uploaded.
        // All files will be run through the same validators and filters
        // automatically.
        $fileInput-&gt;getValidatorChain()
            -&gt;attachByName('filesize',      ['max' =&gt; 204800])
            -&gt;attachByName('filemimetype',  ['mimeType' =&gt; 'image/png,image/x-png'])
            -&gt;attachByName('fileimagesize', ['maxWidth' =&gt; 100, 'maxHeight' =&gt; 100]);

        // All files will be renamed, e.g.:
        //   ./data/tmpuploads/avatar_4b3403665fea6.png,
        //   ./data/tmpuploads/avatar_5c45147660fb7.png
        $fileInput-&gt;getFilterChain()-&gt;attachByName(
            'filerenameupload',
            [
                'target'    =&gt; './data/tmpuploads/avatar.png',
                'randomize' =&gt; true,
            ]
        );
        $inputFilter-&gt;add($fileInput);

        $this-&gt;setInputFilter($inputFilter);
    }
}</code></pre>

<p>You do not need to do anything special with the validators and filters to
support multiple file uploads. All of the files that are uploaded will have the
same validators and filters run against them automatically (from logic within
<code>FileInput</code>). Define them as if a single file was being uploaded.</p>
<h2 id="upload-progress">Upload Progress</h2>
<p>While pure client-based upload progress meters are starting to become available
with <a href="http://www.w3.org/TR/progress-events/">HTML5's Progress Events</a>, not all
browsers have <a href="http://caniuse.com/#feat=xhr2">XMLHttpRequest level 2 support</a>.
For upload progress to work in a greater number of browsers (IE9 and below), you
must use a server-side progress solution.</p>
<p><code>Zend\ProgressBar\Upload</code> provides handlers that can give you the actual state
of a file upload in progress. To use this feature, you need to choose one of the
<a href="https://docs.zendframework.com/zend-progressbar/upload/">Upload Progress Handlers</a>
(APC, uploadprogress, or Session) and ensure that your server setup has the
appropriate extension or feature enabled.</p>
<p>Verify your <code>php.ini</code> <code>session.upload</code> settings before you begin:</p>
<pre class="codehilite"><code class="language-ini linenums">file_uploads = On
post_max_size = 50M
upload_max_filesize = 50M
session.upload_progress.enabled = On
session.upload_progress.freq =  &quot;1%&quot;
session.upload_progress.min_freq = &quot;1&quot;
; Also make certain 'upload_tmp_dir' is writable</code></pre>

<p>When uploading a file with a form POST, you must also include the progress
identifier in a hidden input. The <a href="../helper/upload-progress-helpers/">file upload progress view helpers</a>
provides a convenient way to add the hidden input based on your handler type.</p>
<pre class="codehilite"><code class="language-php linenums">&lt;!-- File: upload-form.phtml --&gt;
&lt;?php
    $fileElement = $form-&gt;get('image-file');
    $form-&gt;prepare();
    echo $this-&gt;form()-&gt;openTag($form);
    echo $this-&gt;formFileSessionProgress(); // Must come before the file input!
?&gt;

    &lt;div class=&quot;form-element&quot;&gt;
        &lt;?= $this-&gt;formLabel($fileElement) ?&gt;
        &lt;?= $this-&gt;formFile($fileElement) ?&gt;
        &lt;?= $this-&gt;formElementErrors($fileElement) ?&gt;
    &lt;/div&gt;

    &lt;button&gt;Submit&lt;/button&gt;

&lt;?= $this-&gt;form()-&gt;closeTag() ?&gt;</code></pre>

<p>When rendered, the HTML should look similar to:</p>
<pre class="codehilite"><code class="language-html linenums">&lt;form name=&quot;upload-form&quot; id=&quot;upload-form&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;
    &lt;input type=&quot;hidden&quot; id=&quot;progress_key&quot; name=&quot;PHP_SESSION_UPLOAD_PROGRESS&quot; value=&quot;12345abcde&quot;&gt;

    &lt;div class=&quot;form-element&quot;&gt;
        &lt;label for=&quot;image-file&quot;&gt;Avatar Image Upload&lt;/label&gt;
        &lt;input type=&quot;file&quot; name=&quot;image-file&quot; id=&quot;image-file&quot;&gt;
    &lt;/div&gt;

    &lt;button&gt;Submit&lt;/button&gt;
&lt;/form&gt;</code></pre>

<p>There are a few different methods for getting progress information to the
browser (long vs. short polling). Here we will use short polling since it is
simpler and less taxing on server resources, though keep in mind it is not as
responsive as long polling.</p>
<p>When our form is submitted via AJAX, the browser will continuously poll the
server for upload progress.</p>
<p>The following is an example controller action which provides the progress
information:</p>
<pre class="codehilite"><code class="language-php linenums">public function uploadProgressAction()
{
    $id = $this-&gt;params()-&gt;fromQuery('id', null);
    $progress = new \Zend\ProgressBar\Upload\SessionProgress();
    return new \Zend\View\Model\JsonModel($progress-&gt;getProgress($id));
}

// Returns JSON
//{
//    &quot;total&quot;    : 204800,
//    &quot;current&quot;  : 10240,
//    &quot;rate&quot;     : 1024,
//    &quot;message&quot;  : &quot;10kB / 200kB&quot;,
//    &quot;done&quot;     : false
//}</code></pre>

<blockquote>
<h3 id="performance-overhead">Performance overhead</h3>
<p>This is <em>not</em> the most efficient way of providing upload progress, since each
polling request must go through the Zend Framework bootstrap process. A better
example would be to use a standalone php file in the public folder that
bypasses the MVC bootstrapping and only uses the essential <code>Zend\ProgressBar</code>
adapters.</p>
</blockquote>
<p>Back in our view template, we will add Javascript to perform the AJAX POST of
the form data, and to start a timeout interval for the progress polling. To keep
the example code relatively short, we are using the <a href="https://github.com/malsup/form">jQuery Form plugin</a>
to do the AJAX form POST. If your project uses a different JavaScript framework
(or none at all), this will hopefully at least illustrate the necessary
high-level logic that would need to be performed.</p>
<pre class="codehilite"><code class="language-php linenums">&lt;?php // File: upload-form.phtml
      // ...after the form...
?&gt;

&lt;!-- Twitter Bootstrap progress bar styles:
     http://twitter.github.com/bootstrap/components.html#progress --&gt;
&lt;div id=&quot;progress&quot; class=&quot;help-block&quot;&gt;
    &lt;div class=&quot;progress progress-info progress-striped&quot;&gt;
        &lt;div class=&quot;bar&quot;&gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;p&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;script src=&quot;https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;/js/jquery.form.js&quot;&gt;&lt;/script&gt;
&lt;script&gt;
var progressInterval;

function getProgress() {
    // Poll our controller action with the progress id
    var url = '/upload-form/upload-progress?id=' + $('#progress_key').val();
    $.getJSON(url, function(data) {
        if (data.status &amp;&amp; !data.status.done) {
            var value = Math.floor((data.status.current / data.status.total) * 100);
            showProgress(value, 'Uploading...');
        } else {
            showProgress(100, 'Complete!');
            clearInterval(progressInterval);
        }
    });
}

function startProgress() {
    showProgress(0, 'Starting upload...');
    progressInterval = setInterval(getProgress, 900);
}

function showProgress(amount, message) {
    $('#progress').show();
    $('#progress .bar').width(amount + '%');
    $('#progress &gt; p').html(message);
    if (amount &lt; 100) {
        $('#progress .progress')
            .addClass('progress-info active')
            .removeClass('progress-success');
    } else {
        $('#progress .progress')
            .removeClass('progress-info active')
            .addClass('progress-success');
    }
}

$(function() {
    // Register a 'submit' event listener on the form to perform the AJAX POST
    $('#upload-form').on('submit', function(e) {
        e.preventDefault();

        if ($('#image-file').val() == '') {
            // No files selected, abort
            return;
        }

        // Perform the submit
        //$.fn.ajaxSubmit.debug = true;
        $(this).ajaxSubmit({
            beforeSubmit: function(arr, $form, options) {
                // Notify backend that submit is via ajax
                arr.push({ name: &quot;isAjax&quot;, value: &quot;1&quot; });
            },
            success: function (response, statusText, xhr, $form) {
                clearInterval(progressInterval);
                showProgress(100, 'Complete!');

                // TODO: You'll need to do some custom logic here to handle a successful
                // form post, and when the form is invalid with validation errors.
                if (response.status) {
                    // TODO: Do something with a successful form post, like redirect
                    // window.location.replace(response.redirect);
                } else {
                    // Clear the file input, otherwise the same file gets re-uploaded
                    // http://stackoverflow.com/a/1043969
                    var fileInput = $('#image-file');
                    fileInput.replaceWith( fileInput.val('').clone( true ) );

                    // TODO: Do something with these errors
                    // showErrors(response.formErrors);
                }
            },
            error: function(a, b, c) {
                // NOTE: This callback is *not* called when the form is invalid.
                // It is called when the browser is unable to initiate or complete the ajax submit.
                // You will need to handle validation errors in the 'success' callback.
                console.log(a, b, c);
            }
        });
        // Start the progress polling
        startProgress();
    });
});
&lt;/script&gt;</code></pre>

<p>And finally, our controller action can be modified to return form status and
validation messages in JSON format if we see the 'isAjax' post parameter (which
was set in the JavaScript just before submit):</p>
<pre class="codehilite"><code class="language-php linenums">public function uploadFormAction()
{
    $form = new UploadForm('upload-form');

    $request = $this-&gt;getRequest();

    if (! $request-&gt;isPost()) {
        return ['form' =&gt; $form];
    }

    // Make certain to merge the files info!
    $post = array_merge_recursive(
        $request-&gt;getPost()-&gt;toArray(),
        $request-&gt;getFiles()-&gt;toArray()
    );

    $form-&gt;setData($post);
    if ($form-&gt;isValid()) {
        $data = $form-&gt;getData();

        // Form is valid, save the form!
        if (! empty($post['isAjax'])) {
            return new JsonModel(array(
                'status'   =&gt; true,
                'redirect' =&gt; $this-&gt;url()-&gt;fromRoute('upload-form/success'),
                'formData' =&gt; $data,
            ));
        }

        // Fallback for non-JS clients
        return $this-&gt;redirect()-&gt;toRoute('upload-form/success');
    }

    if (! empty($post['isAjax'])) {
        // Send back failure information via JSON
        return new JsonModel([
            'status'     =&gt; false,
            'formErrors' =&gt; $form-&gt;getMessages(),
            'formData'   =&gt; $form-&gt;getData(),
        ]);
    }

    return array('form' =&gt; $form);
}</code></pre>

<h2 id="additional-info">Additional Info</h2>
<p>Related documentation:</p>
<ul>
<li><a href="../element/file/">Form File Element</a></li>
<li><a href="../helper/form-file/">Form File View Helper</a></li>
<li><a href="https://docs.zendframework.com/zend-validator/validators/file/intro/">List of File Validators</a></li>
<li><a href="http://zendframework.github.io/zend-filter/file/">List of File Filters</a></li>
<li><a href="https://docs.zendframework.com/zend-mvc-plugin-fileprg/">File Post-Redirect-Get Controller Plugin</a></li>
<li><a href="https://docs.zendframework.com/zend-inputfilter/file-input/">Zend\InputFilter\FileInput</a></li>
<li><a href="https://docs.zendframework.com/zend-progressbar/upload/">Upload Progress Handlers</a></li>
<li><a href="../helper/upload-progress-helpers/">Upload Progress View Helpers</a></li>
</ul>
<p>External resources and blog posts from the community:</p>
<ul>
<li><a href="https://github.com/cgmartin/ZF2FileUploadExamples">ZF2FileUploadExamples</a> : A
  ZF2 module with several file upload examples.</li>
</ul>

<hr />


<nav>
  <ul class="pager hidden-print">
    <li class="previous">
      <a rel="prev" href="../collections/"><i class="fa fa-arrow-left"></i> Previous</a>
    </li>
    <li class="next">
      <a rel="next" href="../helper/intro/">Next <i class="fa fa-arrow-right"></i></a>
    </li>
  </ul>
</nav>
</div>
        
    </div>
    <!-- content:end -->

    <div id="footerwrap">
    <div class="container">
        <div class="row site-map">
            <div class="col-lg-3">
              <p>
                <strong>Zend Framework</strong><br />
                <a href="http://framework.zend.com/">framework.zend.com</a><br />
                <a href="https://docs.zendframework.com">docs.zendframework.com</a><br />
                <a href="https://packages.zendframework.com">packages.zendframework.com</a><br />
                <a href="https://apigility.org">apigility.org</a><br />
              </p>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12 centered">
                <a class="back-to-top" href="#page-top"><i class="fa fa-chevron-circle-up fa-4" aria-hidden="true"></i></a>
            </div>
        </div>

        <div class="spacing"></div>

        <div class="row">
            <div class="col-lg-8">
                <h4>Copyright</h4>
                <div class="hline-w"></div>

                <p>&copy; 2006-2016 by <a href="http://www.zend.com">Zend</a>, a <a href="http://www.roguewave.com/">Rogue Wave Company</a>.</p>
            </div>

            <div class="col-lg-4">
                <h4>Contacts</h4>
                <div class="hline-w"></div>
                <p>
                    <a href="irc://irc.freenode.net/zftalk" class="btn-social btn-outline" alt="IRC" title="IRC"><i class="fa fa-comment"></i></a>
                    <a href="https://github.com/zendframework" class="btn-social btn-outline" alt="Github" title="Github"><i class="fa fa-github"></i></a>
                    <a href="https://twitter.com/zfdevteam" class="btn-social btn-outline" alt="Twitter" title="Twitter"><i class="fa fa-twitter"></i></a>
                </p>
            </div>
        </div>
    </div>
</div>


    <script src="../js/jquery-1.10.2.min.js"></script>
    <script src="../js/bootstrap-3.0.3.min.js"></script>
    <script src="../js/prism-zf.js"></script>

    <script>var base_url = '..';</script>
    <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
    <script src="../js/base.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    <div class="zf-components">
  <div class="zf-components-grid">
    <div class="zf-logo">
      <a href="http://framework.zend.com" data-toggle="tooltip" data-placement="bottom" title="Go to the ZF homepage"><img src="../img/zf-logo-mark.svg" alt="Zend Framework" width="250" /></a>
    </div>

    <div class="component-list"></div>

    <p class="zf-components-rollup"><a href="#">Hide list</a></p>
  </div>
</div>

    <script>
  // Prepare the component list dropdown for display
  $(function () {
    var components = $(".zf-components"),
        componentList = components.find(".component-list"),
        sidebar = $(".bs-sidebar.affix"),
        sidebarInitialPos = sidebar.css("position"),
        hidden,
        componentToggle = $(".component-toggle"),
        navbar = $(".navbar-fixed-top"),
        rollUpLink = $(".zf-components-rollup a");

    // Initial setup on document load
    components.insertBefore(navbar);
    $(".zf-logo a").tooltip();
    componentToggle.tooltip();
    rollUpLink.attr({ href: "#", alt: "Hide component list" });

    // Cast initial sidebar position value
    if (undefined === sidebarInitialPos) {
      sidebarInitialPos = "fixed";
    }

    // Setup onclick events to toggle list
    componentToggle.click(toggleComponentList);
    rollUpLink.click(toggleComponentList);

    // Toggle the component list display
    function toggleComponentList(event) {
      event.preventDefault();

      if (hidden === undefined) {
        // Not loaded yet; load and display.
        loadComponentList();
        return;
      }

      if (hidden) {
        // Hidden; display.
        showComponentList();
        return;
      }

      // Currently visible; hide
      hideComponentList();
    }

    // Show the component list
    function showComponentList() {
      navbar.css({position: "relative"});
      sidebar.css({position: "relative"});
      components
        .css({"margin-top": "-" + components.outerHeight() + "px"})
        .show()
        .animate({"margin-top": 0}, {
          complete: function () {
            componentToggle
              .data("placement", "top")
              .attr("data-original-title", "Hide component list");
            hidden = false;
          },
          queue: false
        });
    }

    // Hide the component list
    function hideComponentList() {
      components.animate({"margin-top": "-" + components.outerHeight() + "px"}, {
        complete: function () {
          navbar.css({position: "fixed"});
          sidebar.css({position: sidebarInitialPos});
          componentToggle
            .data("placement", "bottom")
            .attr("data-original-title", "Show component list");
          components.hide();
          hidden = true;
        },
        queue: false
      });
      sidebar.animate({ top: sidebarInitialTop + "px" }, { queue: false});
    }

    // Inject a component into the componet list DOM.
    function injectComponent(index, component) {
      componentList.append('<div class="component"><h4><a href="' + component.url + '">' + component.name + '</a></h4><p>' + component.description + '</p></div>');
    }

    // Parse the component list, build the DOM, and display it.
    function parseComponentList(components) {
      $.each(components, injectComponent);
      showComponentList();
    }

    // Fetch the component list and display it.
    function loadComponentList () {
      $.ajax({
        url: "//docs.zendframework.com/zf-mkdoc-theme/scripts/zf-component-list.json",
        dataType: "text json",
        success: parseComponentList,
        error: function (e) {
          console.log("Error occurred with XHR call", e);
        }
      });
    }
  });
</script>
    </body>

</html>
